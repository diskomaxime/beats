{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","assets/coffee/modules/Beats.GUI.coffee","assets/coffee/modules/Beats.coffee","assets/coffee/modules/Demo.coffee","assets/coffee/modules/loadBuffers.coffee","node_modules/dat-gui/index.js","node_modules/dat-gui/vendor/dat.color.js","node_modules/dat-gui/vendor/dat.gui.js"],"names":[],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"demo.bundle.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","BEATS       = require 'Beats'\ndat         = require 'dat-gui'\nloadBuffers = require 'loadBuffers'\n\nBEATS.GUI = class GUI\n\n\tconstructor: (@beats) ->\n\n\t\t@output = @beats.analyser\n\t\t@gui = new dat.GUI()\n\n\t\t@assets  =\n\t\t\tbuffers: {}\n\n\t\t@buffers =\n\t\t\tmusic : @beats.media.src\n\n\t\t@controls = document.querySelector '.controls'\n\n\t\t@graphKeys       = document.querySelector '.graph-keys'\n\t\t@graphKeysCanvas = @graphKeys.querySelector 'canvas'\n\t\t@keysByTime      = []\n\t\t@currentKey      = @beats.keys[ 0 ]\n\n\t\t@graphSpectrum       = document.querySelector '.graph-spectrum'\n\t\t@graphSpectrumCanvas = @graphSpectrum.querySelector 'canvas'\n\n\t\t@track       = document.querySelector '.track'\n\t\t@trackCanvas = @track.querySelector 'canvas'\n\t\t@track.addEventListener 'mousedown', (event) => @moveTo event\n\n\t\t@progress = document.querySelector '.progress'\n\t\t@time     = @progress.querySelector '.time'\n\n\t\t@resize()\n\n\t\t## Draw grid\n\t\tgrids = document.querySelectorAll '.grid'\n\n\t\tfor i in [ 0...grids.length ]\n\n\t\t\tlinesCount = ( i + 1 ) * 20\n\n\t\t\tfor j in [ 0..linesCount ]\n\n\t\t\t\tline = document.createElement 'div'\n\n\t\t\t\tif j % 10 == 0\n\t\t\t\t\tline.className = \"line blue\"\n\t\t\t\t\tif j % 20 == 0 then line.className = \"line white\"\n\t\t\t\telse line.className = \"line\"\n\n\t\t\t\tline.style.top = ( 100 / linesCount ) * j + \"%\"\n\t\t\t\tgrids[ i ].appendChild line\n\n\t\t## Draw track\n\t\tloadBuffers @buffers, @assets, =>\n\t\t\t@buffer = @assets.buffers.music\n\t\t\t@updateTrack()\n\n\t\t## Show player controls\n\t\t@media = @beats.input.mediaElement\n\t\t@media.className = 'audio'\n\n\t\t@initializeSequences()\n\t\t@initializeOutputs()\n\t\t@initializeKeys()\n\n\t\t@controls.appendChild @media\n\n\t\t@updateGUI()\n\n\t\tstartTime = performance.now()\n\t\t@oldTime  = startTime\n\n\t\tframeRate = 30\n\t\t@interval = 1000 / frameRate\n\n\t\taddEventListener 'resize', @resize, true\n\n\tchangeOutput: (output) ->\n\n\t\t@output = output\n\t\t@beats.output.disconnect()\n\t\t@output.connect @beats.destination\n\t\t@beats.output = @output\n\n\tresample: (width, audioData) ->\n\n\t\t# http://stackoverflow.com/questions/22073716/create-a-waveform-of-the-full-track-with-web-audio-api\n\t\tresampled = new Float64Array width * 6\n\n\t\ti = j = 0\n\t\tbuckIndex = 0\n\n\t\tmin   = 1e6\n\t\tmax   = -1e6\n\t\tvalue = 0\n\t\tres   = 0\n\n\t\tsampleCount = audioData.length\n\n\t\t## First pass for mean\n\t\ti = 0\n\t\twhile i < sampleCount\n\n\t\t\t## In which bucket do we fall ?\n\t\t\tbuckIndex = 0 | width * i / sampleCount\n\t\t\tbuckIndex *= 6\n\n\t\t\t## Positive or negative ?\n\t\t\tvalue = audioData[ i ]\n\t\t\tif value > 0\n\t\t\t\tresampled[ buckIndex ] += value\n\t\t\t\tresampled[ buckIndex + 1 ] += 1\n\n\t\t\telse if value < 0\n\t\t\t\tresampled[ buckIndex + 3 ] += value\n\t\t\t\tresampled[ buckIndex + 4 ] += 1\n\n\t\t\tif value < min then min = value\n\t\t\tif value > max then max = value\n\n\t\t\ti++\n\n\t\t## Compute mean now\n\t\ti = j = 0\n\t\twhile i < width\n\n\t\t\tif resampled[ j + 1] != 0\n\t\t\t\tresampled[ j ] /= resampled[ j + 1 ]\n\n\t\t\tif resampled[ j + 4 ] != 0\n\t\t\t\tresampled[ j + 3 ] /= resampled[ j + 4 ]\n\n\t\t\ti++\n\t\t\tj += 6\n\n\t\t## Second pass for mean variation  ( variance is too low)\n\t\ti = 0\n\t\twhile i < audioData.length\n\n\t\t\t## In which bucket do we fall ?\n\t\t\tbuckIndex = 0 | width * i / audioData.length\n\t\t\tbuckIndex *= 6\n\n\t\t\t## Positive or negative ?\n\t\t\tvalue = audioData[ i ]\n\t\t\tif value > 0\n\t\t\t\tresampled[ buckIndex + 2 ] += Math.abs resampled[ buckIndex ] - value\n\t\t\telse if value < 0\n\t\t\t\tresampled[ buckIndex + 5 ] += Math.abs resampled[ buckIndex + 3 ] - value\n\n\t\t\ti++\n\n\t\t## Compute mean variation / variance now\n\t\ti = j = 0\n\t\twhile i < width\n\n\t\t\tif resampled[ j + 1 ]\n\t\t\t\tresampled[ j + 2 ] /= resampled[ j + 1 ]\n\n\t\t\tif resampled[ j + 4 ]\n\t\t\t\tresampled[ j + 5 ] /= resampled[ j + 4 ]\n\n\t\t\ti++\n\t\t\tj += 6\n\n\t\treturn resampled\n\n\tinitializeOutputs: ->\n\n\t\t## Draw output container\n\t\t@outputs    = []\n\t\t@values     = []\n\t\t@levels     = []\n\t\t@thresholds = []\n\t\t@circles    = []\n\n\t\ttemplate = @controls.querySelector '.template'\n\t\tfor i in [ 0...@beats.keys.length ]\n\n\t\t\toutput = template.cloneNode true\n\t\t\toutput.className = \"output\"\n\n\t\t\tname = output.querySelector '.name'\n\t\t\tname.innerText = @beats.keys[ i ].name\n\t\t\t@controls.appendChild output\n\n\t\t\t@outputs[ @outputs.length++ ]       = output\n\t\t\t@values[ @values.length++ ]         = output.querySelector '.value'\n\t\t\t@levels[ @levels.length++ ]         = output.querySelector '.level'\n\t\t\t@thresholds[ @thresholds.length++ ] = output.querySelector '.threshold'\n\t\t\t@circles[ @circles.length++ ]       = output.querySelector '.circle'\n\n\tinitializeSequences: ->\n\n\t\tsequences = @track.querySelector '.sequences'\n\t\ttemplate  = @track.querySelector '.template'\n\t\tpositions = @beats.sequencer.positions\n\n\t\tfor i in [ 0...positions.length ]\n\n\t\t\tposition = positions[ i ] / @media.duration\n\n\t\t\tsequence = template.cloneNode true\n\t\t\tsequence.className = \"sequence\"\n\t\t\tsequence.style.transform = 'translateX(' + position * 100 + \"%)\"\n\n\t\t\tvalue = sequence.querySelector '.value'\n\t\t\tvalue.innerText = positions[ i ]\n\n\t\t\tname = sequence.querySelector '.name'\n\t\t\tname.innerText = @beats.sequencer.names[ i ]\n\t\t\tsequences.appendChild sequence\n\n\tinitializeKeys: ->\n\n\t\t@keys = []\n\n\t\ttemplate = @graphSpectrum.querySelector '.template'\n\t\tfor i in [ 0...@beats.keys.length ]\n\n\t\t\tkey = template.cloneNode true\n\t\t\t@keys[ i ] = key\n\n\t\t\tname = key.querySelector '.name'\n\t\t\tname.innerText = @beats.keys[ i ].name\n\t\t\t@graphSpectrum.appendChild key\n\n\t\t@updateKeys()\n\n\tmoveTo: (event) ->\n\n\t\tprogress = ( event.clientX - @track.offsetLeft ) / @track.clientWidth\n\t\t@media.currentTime = progress * @media.duration\n\n\tupdateTrack: =>\n\n\t\tif !@buffer? then return\n\n\t\twidth = @trackCanvas.width\n\n\t\tcontext = @trackCanvas.getContext '2d'\n\t\tresampledData = @resample width, @buffer.getChannelData 0\n\n\t\tcontext.translate 0.5, @trackCanvas.clientHeight * 0.5\n\t\tcontext.scale 1, 100\n\t\ti = 0\n\n\t\twhile i < width\n\n\t\t\tj = i * 6\n\n\t\t\t# update from positiveAvg - variance to negativeAvg - variance\n\t\t\tcontext.strokeStyle = '#ffffff'\n\t\t\tcontext.beginPath()\n\t\t\tcontext.moveTo i, resampledData[ j ] - ( resampledData[ j + 2 ] )\n\t\t\tcontext.lineTo i, resampledData[ j + 3 ] + resampledData[ j + 5 ]\n\t\t\tcontext.stroke()\n\n\t\t\t# update from positiveAvg - variance to positiveAvg + variance\n\t\t\tcontext.beginPath()\n\t\t\tcontext.moveTo i, resampledData[ j ] - ( resampledData[ j + 2 ] )\n\t\t\tcontext.lineTo i, resampledData[ j ] + resampledData[ j + 2 ]\n\t\t\tcontext.stroke()\n\n\t\t\t# update from negativeAvg + variance to negativeAvg - variance\n\t\t\tcontext.beginPath()\n\t\t\tcontext.moveTo i, resampledData[ j + 3 ] + resampledData[ j + 5 ]\n\t\t\tcontext.lineTo i, resampledData[ j + 3 ] - ( resampledData[ j + 5 ] )\n\t\t\tcontext.stroke()\n\t\t\ti++\n\n\tupdateOutputs: ->\n\n\t\tfor i in [ 0...@beats.keys.length ]\n\n\t\t\tkey = @beats.keys[ i ]\n\n\t\t\tif key.threshold?\n\t\t\t\t@thresholds[ i ].style.height = 100 * key.currentThreshold + \"%\"\n\t\t\t\t@thresholds[ i ].style.display = \"block\"\n\t\t\telse\n\t\t\t\t@thresholds[ i ].style.display = \"none\"\n\n\t\t\tif key.active\n\n\t\t\t\t@outputs[ i ].style.opacity = 1.0\n\t\t\t\t@levels[ i ].style.height = 100 * key.value + \"%\"\n\t\t\t\t@circles[ i ].style.transform = 'translateX(-25%) scale(' + key.value + ')'\n\n\t\t\telse\n\n\t\t\t\t@outputs[ i ].style.opacity = 0.2\n\n\t\t\t@values[ i ].innerText = key.value.toFixed 3\n\n\tupdateKeys: =>\n\n\t\t## Draw keys\n\t\tfor i in [ 0...@keys.length ]\n\n\t\t\tkey = @keys[ i ]\n\t\t\tvalues = @beats.keys[ i ]\n\n\t\t\tif values.active then key.className = \"key active\"\n\t\t\telse key.className = \"key\"\n\n\t\t\tx = values.start * @levelSize\n\t\t\ty = ( 1 - values.max ) * @graphSpectrumCanvas.height\n\n\t\t\twidth  = ( values.end - values.start ) * @levelSize\n\t\t\theight = ( values.max - values.min ) * @graphSpectrumCanvas.height\n\n\t\t\tkey.style.height    = height  + 'px'\n\t\t\tkey.style.width     = width  + 'px'\n\t\t\tkey.style.transform = 'translate(' + x + 'px,' + y + 'px)'\n\n\tupdateProgress: ->\n\n\t\tprogress = @media.currentTime / @media.duration\n\t\t@progress.style.transform = 'translateX(' + progress * 100 + '%)'\n\t\t@time.innerText = @media.currentTime.toFixed 3\n\n\tupdateGraphKeys: ->\n\n\t\tcontext = @graphKeysCanvas.getContext '2d'\n\t\tcontext.clearRect 0, 0, @graphSpectrumCanvas.width, @graphSpectrumCanvas.height\n\n\t\tcontext.strokeStyle = \"#5AAAFF\"\n\n\t\tif @keysByTime.length >= @waveCountKeys then @keysByTime.shift()\n\n\t\tif !@currentKey? then return\n\t\t@keysByTime[ @keysByTime.length++ ] = @currentKey.value\n\n\t\tcontext.beginPath()\n\t\tcontext.setLineDash []\n\n\t\tfor i in [ 0...@waveCountKeys ]\n\n\t\t\theight = -@keysByTime[ i ] * @graphKeysCanvas.height + @graphKeysCanvas.height\n\t\t\tcontext.lineTo i * @waveSizeKeys, height\n\n\t\tcontext.stroke()\n\n\t\tif !@currentKey.threshold? then return\n\n\t\t## Threshold\n\t\tcontext.beginPath()\n\t\tcontext.strokeStyle = \"white\"\n\n\t\theight = -@currentKey.threshold * @graphKeysCanvas.height + @graphKeysCanvas.height\n\t\tcontext.setLineDash [ 5, 5 ]\n\t\tcontext.moveTo 0, height\n\t\tcontext.lineTo @graphKeysCanvas.width, height\n\t\tcontext.stroke()\n\n\tupdateGraphSpectrum: ->\n\n\t\tcontext = @graphSpectrumCanvas.getContext '2d'\n\t\tcontext.clearRect 0, 0, @graphSpectrumCanvas.width, @graphSpectrumCanvas.height\n\n\t\tfor i in [ 0...@levelCount ]\n\n\t\t\tcontext.fillStyle = '#5AAAFF'\n\n\t\t\tif @spectrum[ i ] > 0\n\n\t\t\t\tx = i * @levelSize\n\t\t\t\theight = @output.spectrum[ i ] *  @graphSpectrumCanvas.height\n\n\t\t\t\toffset = 0.2\n\t\t\t\tgap    = @levelSize * offset\n\t\t\t\twidth  = @levelSize * ( 1 - offset )\n\n\t\t\t\ty = @graphSpectrumCanvas.height - height\n\t\t\t\tcontext.fillRect x, y, width, height\n\n\n\t\tcontext.beginPath()\n\n\t\tcontext.strokeStyle = \"rgba(200, 200, 200, 0.95)\"\n\n\t\thalfHeight = @graphSpectrumCanvas.height * 0.5\n\t\tfor i in [ 0...@waveCount ]\n\n\t\t\theight = @output.waveform[ i ] * halfHeight + halfHeight\n\t\t\tcontext.lineTo i * @waveSize, height\n\n\t\tcontext.stroke()\n\n\tupdateGUI: ->\n\n\t\tmodulators = [ null ]\n\t\tmodulatorsFolder = @gui.addFolder 'Modulators'\n\n\t\tfor i in [ 0...@beats.modulators.length ]\n\n\t\t\tmodulator = @beats.modulators[ i ]\n\t\t\tmodulatorFolder = modulatorsFolder.addFolder modulator.name\n\n\t\t\tmodulators[ modulators.length++ ] = modulator.name\n\n\t\t\tfilter = modulator.filter\n\t\t\tmodulator.output = false\n\n\t\t\tthat = @\n\n\t\t\tmodulatorsNeedsUpdate = (boolean) ->\n\n\t\t\t\tname = that.graphSpectrum.querySelector '.container-name span'\n\n\t\t\t\tfor i in [ 0...that.beats.modulators.length ]\n\t\t\t\t\tif @object.name == that.beats.modulators[ i ].name\n\n\t\t\t\t\t\tif boolean\n\t\t\t\t\t\t\tname.innerText = @object.name\n\t\t\t\t\t\t\tthat.changeOutput @object.analyser\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthat.changeOutput that.beats.analyser\n\t\t\t\t\t\t\tname.innerText = 'Main analyser'\n\t\t\t\t\t\t\tthat.beats.modulators[ i ].output = false\n\n\t\t\toutput = modulatorFolder.add( modulator, 'output' )\n\t\t\toutput.name('output')\n\t\t\toutput.listen().onChange( modulatorsNeedsUpdate )\n\n\t\t\tfrequency = modulatorFolder.add( filter.frequency, 'value', 0, 40000 )\n\t\t\tfrequency.name('frequency')\n\t\t\tfrequency.listen().onChange( modulatorsNeedsUpdate )\n\n\t\t\tQ = modulatorFolder.add( filter.Q, 'value', 0, 10)\n\t\t\tQ.name('Q')\n\t\t\tQ.listen().step( 1 ).onChange( modulatorsNeedsUpdate )\n\n\t\t\tgain = modulatorFolder.add( filter.gain, 'value', 0, 10 ).name('gain')\n\t\t\tgain.name('gain')\n\t\t\tgain.listen().step( 1 ).onChange( modulatorsNeedsUpdate )\n\n\n\t\tkeysFolder = @gui.addFolder 'Keys'\n\t\tfor i in [ 0...@beats.keys.length ]\n\n\t\t\tkey = @beats.keys[ i ]\n\t\t\tkeyFolder = keysFolder.addFolder key.name\n\n\t\t\tkeyFolder.add( key, 'active', ).listen().onChange( @updateKeys )\n\t\t\tkeyFolder.add( key, 'start', 0, @levelCount ).listen().step( 1 ).onChange( @updateKeys )\n\t\t\tkeyFolder.add( key, 'end'  , 0, @levelCount ).listen().step( 1 ).onChange( @updateKeys )\n\t\t\tkeyFolder.add( key, 'min'  , 0, 1 ).listen().step( 0.01 ).onChange( @updateKeys )\n\t\t\tkeyFolder.add( key, 'max'  , 0, 1 ).listen().step( 0.01 ).onChange( @updateKeys )\n\t\t\tkeyFolder.add( key, 'modulator', modulators ).listen().onChange( @updateKeys )\n\n\n\t\t\tif !i then key.graph = true else key.graph = false\n\n\t\t\tthat = @\n\t\t\tkeyFolder.add( key, 'graph', ).listen().onChange( (value) ->\n\n\t\t\t\tfor i in [ 0...that.beats.keys.length ]\n\t\t\t\t\tthat.beats.keys[ i ].graph = false\n\n\t\t\t\tname = that.graphKeys.querySelector '.container-name span'\n\t\t\t\tif value\n\t\t\t\t\tthat.currentKey = @object\n\t\t\t\t\tname.innerText = @object.name\n\t\t\t\t\t@object.graph = true\n\t\t\t\telse\n\t\t\t\t\tthat.currentKey = null\n\t\t\t\t\tname.innerText = 'Nothing selected'\n\t\t\t)\n\n\tupdate: ->\n\n\t\tnewTime = performance.now()\n\t\tdelta   = newTime - @oldTime\n\n\t\t## Control draw loop frame rate\n\t\tif delta > @interval\n\t\t\t@oldTime = newTime - ( delta % @interval )\n\t\t\t@updateGraphKeys()\n\n\t\t@spectrum = @output.spectrum\n\t\t@waveform = @output.waveform\n\n\t\tif @waveform? and @spectrum? and !@beats.media.paused\n\t\t\t@updateGraphSpectrum()\n\t\t\t@updateOutputs()\n\t\t\t@updateProgress()\n\n\tresize: =>\n\n\t\tWIDTH  = window.innerWidth\n\t\tHEIGHT = window.innerHeight\n\n\t\t@graphSpectrumCanvas.width  = @graphSpectrum.clientWidth\n\t\t@graphSpectrumCanvas.height = @graphSpectrum.clientHeight\n\n\t\t@trackCanvas.width  = @track.clientWidth\n\t\t@trackCanvas.height = @track.clientHeight\n\n\t\t@graphKeysCanvas.width  = @graphKeysCanvas.parentNode.clientWidth\n\t\t@graphKeysCanvas.height = @graphKeysCanvas.parentNode.clientHeight\n\n\t\t@levelCount = @beats.levelCount || @beats.analyser.frequencyData.length\n\t\t@levelSize = Math.round @graphSpectrumCanvas.width / @levelCount\n\n\t\t@waveCount = @beats.analyser.timeDomainData.length\n\t\t@waveSize  = @graphSpectrumCanvas.width / @waveCount\n\n\t\t@waveCountKeys = 300\n\t\t@waveSizeKeys  = @graphKeysCanvas.width / @waveCountKeys\n\n\t\t@updateTrack()\n\n\n\n","BEATS = {}\nmodule.exports = BEATS\n\nclass BEATS.Interface\n\n\tconstructor: (@context, @input, parameters) ->\n\n\t\t@keys       = []\n\t\t@modulators = []\n\n\t\t## Default analyser\n\t\t@analyser = @context.createAnalyser()\n\t\tif parameters.mono then @input.channelCount = 1\n\t\t@input.connect @analyser\n\n\t\t@media    = @input.mediaElement\n\t\t@duration = @media.duration\n\t\t@active   = false\n\n\t\t## Connect the analyser to the destination\n\t\t@destination = parameters.destination\n\t\tif @destination?\n\t\t\t@analyser.connect @destination\n\n\t\t\t## Set the analyser as output\n\t\t\t@output = @analyser\n\n\t\tif parameters.fftSize then @analyser.fftSize = parameters.fftSize\n\t\tif parameters.smoothingTimeConstant\n\t\t\t@analyser.smoothingTimeConstant = parameters.smoothingTimeConstant\n\n\t\t## Create typed array to store data\n\t\t@analyser.frequencyData  = new Uint8Array @analyser.frequencyBinCount\n\t\t@analyser.timeDomainData = new Uint8Array @analyser.frequencyBinCount\n\n\t\t@analyser.normalizedFrequencyData  = new Float32Array @analyser.frequencyBinCount\n\t\t@analyser.normalizedTimeDomainData = new Float32Array @analyser.frequencyBinCount\n\n\t\t## Restrict level counts\n\t\tif parameters.levelCount? then @setLevelCount parameters.levelCount\n\n\t\t## Update the default analyser once on start\n\t\t@getSpectrum @analyser, true\n\t\t@getWaveform @analyser, true\n\n\tsetLevelCount: (levelCount) ->\n\n\t\t## Create typed array to store data\n\t\t@levelCount      = levelCount\n\t\t@levelStep       = @analyser.frequencyBinCount / @levelCount\n\t\t@analyser.levels = new Float32Array @levelCount\n\n\tstereoToMono: (audioBuffer) ->\n\n\t\tif audioBuffer.numberOfChannels = 2\n\n\t\t\tleftChannel  = audioBuffer.getChannelData 0\n\t\t\trightChannel = audioBuffer.getChannelData 1\n\n\t\t\ti = audioBuffer.length\n\t\t\twhile i--\n\n\t\t\t\tmixedChannel = 0.5 * ( leftChannel[ i ] + rightChannel[ i ] )\n\t\t\t\tleftChannel[ i ] = rightChannel[ i ] = mixedChannel\n\n\tgetSpectrum: (analyser, normalized) =>\n\n\t\t## Raw data\n\t\tanalyser.getByteFrequencyData analyser.frequencyData\n\t\tspectrum = analyser.frequencyData\n\n\t\t## Get normalized values\n\t\tif normalized\n\n\t\t\ti = analyser.frequencyData.length\n\t\t\twhile i--\n\t\t\t\tanalyser.normalizedFrequencyData[ i ] = analyser.frequencyData[ i ] / 256\n\n\t\t\tspectrum = analyser.normalizedFrequencyData\n\n\t\t## Get sampled values\n\t\tif @levelCount?\n\n\t\t\ti = @levelCount\n\t\t\twhile i--\n\n\t\t\t\tstart = i * @levelStep\n\t\t\t\tend   = ( i + 1 ) * @levelStep - 1\n\n\t\t\t\tanalyser.levels[ i ] = @getFrequency spectrum, start, end\n\n\t\t\tspectrum = analyser.levels\n\n\t\tanalyser.spectrum = spectrum\n\t\treturn spectrum\n\n\tgetWaveform: (analyser, normalized) ->\n\n\t\tanalyser.getByteTimeDomainData analyser.timeDomainData\n\t\twaveform = analyser.timeDomainData\n\n\t\t## Get normalized values\n\t\tif normalized\n\n\t\t\ti = analyser.timeDomainData.length\n\t\t\twhile i--\n\t\t\t\tanalyser.normalizedTimeDomainData[ i ] = ( analyser.timeDomainData[ i ] - 128 ) / 128\n\n\t\t\twaveform = analyser.normalizedTimeDomainData\n\n\t\tanalyser.waveform = waveform\n\t\treturn waveform\n\n\tgetFrequency: (spectrum, start, end) ->\n\n\t\t## Get the average frequency between start and end\n\t\tif end - start > 1\n\n\t\t\t## Sum up selected frequencies\n\t\t\tsum = 0\n\t\t\tfor i in [ start..end ]\n\t\t\t\tsum += spectrum[ i ]\n\n\t\t\t## Divide by length\n\t\t\treturn sum / ( end - start + 1 )\n\n\t\telse return spectrum[ start ]\n\n\tgetMaxFrequency: (spectrum, start, end) ->\n\n\t\tmax = 0\n\t\tif !end? then end = start\n\n\t\tfor i in [ start..end ]\n\t\t\tif spectrum[ i ] > max then max = spectrum[ i ]\n\n\t\treturn max\n\n\tadd: (object) ->\n\n\t\tif object instanceof BEATS.Modulator\n\n\t\t\tif !object.name? then modulator.name = 'M' + @modulators.length\n\n\t\t\tobject.context = @context\n\t\t\tobject.set()\n\t\t\tobject.analyser.levels = new Float32Array @levelCount\n\n\t\t\t@input.connect object.filter\n\n\t\t\t@modulators[ @modulators.length++ ] = object\n\n\t\tif object instanceof BEATS.Key\n\n\t\t\tif !object.name? then object.name = 'K' + @keys.length\n\n\t\t\t@keys[ @keys.length++ ] = object\n\n\t\tif object instanceof BEATS.Sequencer\n\n\t\t\tobject.time     = @media.currentTime\n\t\t\tobject.duration = @media.duration\n\n\t\t\tnames = object.names\n\t\t\tfor i in [0...names.length]\n\n\t\t\t\tif !names[ i ]? then names[ i ] = \"S\" + i\n\n\t\t\t@sequencer = object\n\n\tremove: (object) ->\n\n\t\tswitch object.constructor.name\n\n\t\t\twhen 'Modulator' then objects = @modulators\n\t\t\twhen 'Key' then objects = @keys\n\t\t\twhen 'Sequencer' then objects = @sequencer\n\t\t\telse console.log ''\n\n\t\ti = objects.length\n\t\twhile i--\n\t\t\tif objects[ i ] == object then objects.splice i, 1\n\n\tget: (name) ->\n\n\t\tif typeof name == 'string'\n\n\t\t\ti = @keys.length\n\t\t\twhile i--\n\t\t\t\tif @keys[ i ].name == name then return @keys[ i ]\n\n\t\t\ti = @modulators.length\n\t\t\twhile i--\n\t\t\t\tif @modulators[ i ].name == name then return @modulators[ i ]\n\n\t\telse return\n\n\tupdate: =>\n\n\t\tif !@media? or @media.paused or !@active then return\n\n\t\t## Update time and progression\n\t\t@currentTime = @media.currentTime\n\t\t@progress    = @currentTime / @duration\n\n\t\t## Update main analyser\n\t\t@getSpectrum @analyser, true\n\t\t@getWaveform @analyser, true\n\n\t\t## Update modulators analyser\n\t\ti = @modulators.length\n\t\twhile i--\n\n\t\t\tmodulator = @modulators[ i ]\n\t\t\tif !modulator.active then continue\n\n\t\t\tanalyser = modulator.analyser\n\t\t\t@getSpectrum analyser, true\n\t\t\t@getWaveform analyser, true\n\n\t\t## Update keys value\n\t\ti = @keys.length\n\t\twhile i--\n\n\t\t\tkey = @keys[ i ]\n\t\t\tmodulator = null\n\n\t\t\t## Check if the key needs to be modulated\n\t\t\tif key.modulator? then modulator = @get key.modulator\n\n\t\t\t## Check if the modulator exists and is active\n\t\t\tif modulator? and modulator.active then spectrum = modulator.analyser.spectrum\n\n\t\t\t## Else use the default spectrum\n\t\t\telse spectrum = @analyser.spectrum\n\n\t\t\t## Get the average or the maximal frequency according to key type\n\t\t\tif key.type == \"average\"\n\t\t\t\tfrequency = @getFrequency spectrum, key.start, key.end\n\n\t\t\telse if key.type == \"max\"\n\t\t\t\tfrequency = @getMaxFrequency spectrum, key.start, key.end\n\n\t\t\tkey.update frequency\n\n\t\t## Update sequencer with current time\n\t\tif @sequencer? then @sequencer.update @currentTime\n\n\nclass BEATS.Modulator\n\n\tconstructor: (type, frequency, parameters) ->\n\n\t\t@type      = type\n\t\t@frequency = frequency\n\n\t\t@name   = parameters.name\n\t\t@active = parameters.active\n\n\t\t@Q    = parameters.Q\n\t\t@gain = parameters.gain\n\n\tset: (frequency, Q, gain) ->\n\n\t\t@filter   = @context.createBiquadFilter()\n\t\t@volume   = @context.createGain()\n\t\t@analyser = @context.createAnalyser()\n\n\t\t@filter.connect @volume\n\t\t@volume.connect @analyser\n\n\t\t@analyser.frequencyData  = new Uint8Array @analyser.frequencyBinCount\n\t\t@analyser.timeDomainData = new Uint8Array @analyser.frequencyBinCount\n\n\t\t@analyser.normalizedFrequencyData  = new Float32Array @analyser.frequencyBinCount\n\t\t@analyser.normalizedTimeDomainData = new Float32Array @analyser.frequencyBinCount\n\n\t\t@filter.type            = @type\n\t\t@filter.frequency.value = @frequency\n\n\t\tif @filter.Q? and @Q?\n\t\t\t@filter.Q.value = @Q\n\n\t\tif @filter.gain? and @gain?\n\t\t\t@filter.gain.value = @gain\n\nclass BEATS.Key\n\n\tconstructor: (start, end, min, max, parameters) ->\n\n\t\t@set start, end, min, max\n\t\tif !parameters? then parameters = {}\n\n\t\t@value    = 0\n\t\t@friction = parameters.friction\n\n\t\t@delay   = parameters.delay\n\t\t@timeout = null\n\t\t@lower   = true\n\n\t\t@threshold = parameters.threshold\n\t\t@currentThreshold = @threshold\n\n\t\t@type = parameters.type || 'average'\n\n\t\t@name      = parameters.name\n\t\t@modulator = parameters.modulator || null\n\t\t@active    = parameters.active\n\n\t\tif parameters.callback? then @callback = parameters.callback\n\n\tset: (start, end, min, max) ->\n\n\t\t@start = start\n\t\t@end   = end\n\t\t@min   = min\n\t\t@max   = max\n\n\tupdate: (frequency) =>\n\n\t\tif !@active\n\t\t\t@value = 0\n\t\t\treturn\n\n\t\t## Compute value\n\t\tvalue = ( frequency - @min ) / ( @max - @min )\n\n\t\t## Constricts value\n\t\tvalue = Math.min 1, Math.max 0, value\n\n\t\t## Smooth value\n\t\tif @friction then @value += ( value - @value ) * @friction\n\t\telse @value = value\n\n\t\t## Check if callback should be call\n\t\tif !@threshold then return\n\n\t\tif @value >= @currentThreshold and @lower\n\n\t\t\tcallback = => @lower = true\n\t\t\t@timeout = setTimeout callback, @delay\n\t\t\t@lower   = false\n\n\t\t\tif @callback? then @callback()\n\n\nclass BEATS.Sequencer\n\n\tconstructor: (parameters) ->\n\n\t\tsequences = parameters.sequences\n\n\t\t## Add a starting point at 0\n\t\tsequences.unshift [ 0 ]\n\n\t\t## Sequencer callbacks\n\t\t@onChange = parameters.onChange\n\n\t\t## Sequences positions\n\t\t@positions = []\n\t\t@names     = []\n\n\t\t## Sequences callbacks\n\t\t@onStartCallbacks    = []\n\t\t@onUpdateCallbacks   = []\n\t\t@onCompleteCallbacks = []\n\n\t\tfor i in [ 0...sequences.length ]\n\n\t\t\tsequence = sequences[ i ]\n\n\t\t\tpositions  = sequence[ 0 ]\n\t\t\tparameters = sequence[ 1 ] || {}\n\n\t\t\t@positions[ @positions.length++ ] = positions\n\t\t\t@names[ @names.length++ ]         = parameters.name\n\n\t\t\t@onStartCallbacks[ @onStartCallbacks.length++ ]       = parameters.onStart\n\t\t\t@onUpdateCallbacks[ @onUpdateCallbacks.length++ ]     = parameters.onUpdate\n\t\t\t@onCompleteCallbacks[ @onCompleteCallbacks.length++ ] = parameters.onComplete\n\n\t\t@index = 0\n\n\tupdate: (currentTime) ->\n\n\t\tif @onUpdateCallbacks[ @index ]? then @onUpdateCallbacks[ @index ]()\n\n\t\tif currentTime >= @positions[ @index + 1 ]\n\n\t\t\tif @onCompleteCallbacks[ @index ]? then @onCompleteCallbacks[ @index ]()\n\n\t\t\t@index++\n\n\t\t\tif @onStartCallbacks[ @index ]? then @onStartCallbacks[ @index ]()\n\n\t\t\tif @onChange? then @onChange()\n","BEATS = require 'Beats'\nrequire 'Beats.GUI'\n\naudioContext =  new AudioContext\n\n# Create an audio element\naudio = new Audio()\n\nurl = 'audio/Walk.mp3'\n\naudio.src      = url\naudio.controls = true\naudio.autoplay = false\naudio.loop     = true\n\nready = false\n\naudio.oncanplaythrough = ->\n\n\tif @readyState != 4 || ready == true then return\n\tready = true\n\n\t# Create media element source node\n\tinput = audioContext.createMediaElementSource audio\n\tinput.mediaElement.play()\n\tinput.mediaElement.currentTime = 28\n\n\t## Initialize Beats interface to handle Keys and Modulators\n\tbeats = new BEATS.Interface audioContext, input,\n\t\tdestination : audioContext.destination\n\t\tfftSize     : 1024  ## Size of the Fast Fourier Transform\n\t\tlevelCount  : 128   ## Must be a power of two\n\t\tmono        : false ## Down-mix from stereo to mono\n\n\n\tbeats.add new BEATS.Modulator 'lowpass', 440,\n\t\tname   : 'lowpass'\n\t\tactive : true\n\t\tQ      : 1\n\t\tgain   : 2\n\n\tbeats.add new BEATS.Modulator 'highpass', 10000,\n\t\tname   : 'highpass1'\n\t\tactive : true\n\t\tQ      : 1\n\t\tgain   : 2\n\n\tbeats.add new BEATS.Modulator 'highpass', 2000,\n\t\tname   : 'highpass2'\n\t\tactive : true\n\t\tQ      : 1\n\t\tgain   : 2\n\n\n\tbeats.add new BEATS.Key 1.0, 2.0, 0.8, 0.9,\n\t\tname      : 'kick'\n\t\tmodulator : 'lowpass'\n\t\tactive    : false\n\t\tthreshold : 0.9 ## Minimal value for callback\n\t\tdelay     : 200 ## Delay between the callback can be called\n\t\tcallback  : -> console.log 'Kicked'\n\n\tbeats.add new BEATS.Key 90, 120, 0.1, 0.35,\n\t\tname      : 'hit-hat'\n\t\tmodulator : 'highpass1'\n\t\tactive    : false\n\n\tbeats.add new BEATS.Key 50, 90, 0.4, 0.5,\n\t\tname      : 'snare'\n\t\tmodulator : 'highpass2'\n\t\ttype      : 'max'\n\t\tactive    : false\n\t\tthreshold : 0.9\n\t\tdelay     : 200\n\n\tbeats.add new BEATS.Key 12, 30, 0.1, 0.35,\n\t\tname   : 'piano'\n\t\tactive : true\n\n\tbeats.add new BEATS.Key 68, 88, 0.08, 0.3,\n\t\tname   : 'effect'\n\t\tactive : true\n\n\n\tsequences = [\n\t\t[\n\t\t\t27\n\t\t\tonStart : =>\n\n\t\t\t\tbeats.get( 'kick' ).active = true\n\t\t\t\tbeats.get( 'kick' ).min    = 0.88\n\n\t\t\t\tbeats.get( 'snare' ).active  = true\n\t\t\t\tbeats.get( 'effect' ).active = false\n\t\t\t\tbeats.get( 'piano' ).active  = false\n\t\t]\n\t\t[\n\t\t\t54\n\t\t\tonStart : =>\n\t\t\t\tbeats.get( 'hit-hat' ).active = true\n\t\t]\n\t\t[\n\t\t\t82\n\t\t\tonStart : =>\n\t\t\t\tbeats.get( 'kick' ).set 1, 2, 0.88, 0.92\n\t\t\t\tbeats.get( 'lowpass' ).filter.frequency.value = 100\n\t\t]\n\t]\n\n\tsequencer = beats.add new BEATS.Sequencer\n\t\tonChange  : -> console.log 'Sequence change'\n\t\tsequences : sequences\n\n\n\tbeats.active = true\n\n\tbeatsGUI = new BEATS.GUI beats\n\tsequencer.onChange = => beatsGUI.updateKeys()\n\n\n\n\t## Update loop\n\tstartTime = performance.now()\n\toldTime   = startTime\n\n\tframeRate = 30\n\tinterval  = 1000 / frameRate\n\n\tupdate = ->\n\n\t\tnewTime  = performance.now()\n\t\tdelta    = newTime - oldTime\n\n\t\t## Control draw loop frame rate\n\t\tif delta > interval\n\n\t\t\toldTime = newTime - ( delta % interval )\n\t\t\tbeats.update()\n\t\t\tbeatsGUI.update()\n\n\t\trequestAnimationFrame update\n\n\tupdate()\n","module.exports = (buffers, assets, callback) =>\n\n\t\tif !window.AudioContext? then return\n\t\taudioContext = new AudioContext\n\n\t\tkeys = Object.keys buffers\n\t\tlength = keys.length - 1\n\n\t\tload = (name) =>\n\n\t\t\tsource = buffers[ name ]\n\n\t\t\trequest = new XMLHttpRequest()\n\t\t\trequest.open \"GET\", source, true\n\t\t\trequest.responseType = \"arraybuffer\"\n\n\t\t\trequest.onload = =>\n\n\t\t\t\taudioContext.decodeAudioData \\\n\n\t\t\t\t\trequest.response\n\t\t\t\t\t,(decodedBuffer) =>\n\n\t\t\t\t\t\tassets.buffers[ name ] = decodedBuffer\n\t\t\t\t\t\tnext()\n\n\t\t\t\t\t,(decodedBuffer) =>\n\t\t\t\t\t\tconsole.log 'Error during the load. Wrong url or cross origin issue'\n\t\t\t\t\t\tnext()\n\n\t\t\trequest.send()\n\n\t\tnext = =>\n\n\t\t\tlength--\n\n\t\t\tif length < 0 then callback()\n\t\t\telse load keys[ length ]\n\n\t\tload keys[ length ]\n","module.exports = require('./vendor/dat.gui')\nmodule.exports.color = require('./vendor/dat.color')","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @namespace */\nvar dat = module.exports = dat || {};\n\n/** @namespace */\ndat.color = dat.color || {};\n\n/** @namespace */\ndat.utils = dat.utils || {};\n\ndat.utils.common = (function () {\n  \n  var ARR_EACH = Array.prototype.forEach;\n  var ARR_SLICE = Array.prototype.slice;\n\n  /**\n   * Band-aid methods for things that should be a lot easier in JavaScript.\n   * Implementation and structure inspired by underscore.js\n   * http://documentcloud.github.com/underscore/\n   */\n\n  return { \n    \n    BREAK: {},\n  \n    extend: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (!this.isUndefined(obj[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n      \n    },\n    \n    defaults: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (this.isUndefined(target[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n    \n    },\n    \n    compose: function() {\n      var toCall = ARR_SLICE.call(arguments);\n            return function() {\n              var args = ARR_SLICE.call(arguments);\n              for (var i = toCall.length -1; i >= 0; i--) {\n                args = [toCall[i].apply(this, args)];\n              }\n              return args[0];\n            }\n    },\n    \n    each: function(obj, itr, scope) {\n\n      \n      if (ARR_EACH && obj.forEach === ARR_EACH) { \n        \n        obj.forEach(itr, scope);\n        \n      } else if (obj.length === obj.length + 0) { // Is number but not NaN\n        \n        for (var key = 0, l = obj.length; key < l; key++)\n          if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) \n            return;\n            \n      } else {\n\n        for (var key in obj) \n          if (itr.call(scope, obj[key], key) === this.BREAK)\n            return;\n            \n      }\n            \n    },\n    \n    defer: function(fnc) {\n      setTimeout(fnc, 0);\n    },\n    \n    toArray: function(obj) {\n      if (obj.toArray) return obj.toArray();\n      return ARR_SLICE.call(obj);\n    },\n\n    isUndefined: function(obj) {\n      return obj === undefined;\n    },\n    \n    isNull: function(obj) {\n      return obj === null;\n    },\n    \n    isNaN: function(obj) {\n      return obj !== obj;\n    },\n    \n    isArray: Array.isArray || function(obj) {\n      return obj.constructor === Array;\n    },\n    \n    isObject: function(obj) {\n      return obj === Object(obj);\n    },\n    \n    isNumber: function(obj) {\n      return obj === obj+0;\n    },\n    \n    isString: function(obj) {\n      return obj === obj+'';\n    },\n    \n    isBoolean: function(obj) {\n      return obj === false || obj === true;\n    },\n    \n    isFunction: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Function]';\n    }\n  \n  };\n    \n})();\n\n\ndat.color.toString = (function (common) {\n\n  return function(color) {\n\n    if (color.a == 1 || common.isUndefined(color.a)) {\n\n      var s = color.hex.toString(16);\n      while (s.length < 6) {\n        s = '0' + s;\n      }\n\n      return '#' + s;\n\n    } else {\n\n      return 'rgba(' + Math.round(color.r) + ',' + Math.round(color.g) + ',' + Math.round(color.b) + ',' + color.a + ')';\n\n    }\n\n  }\n\n})(dat.utils.common);\n\n\ndat.Color = dat.color.Color = (function (interpret, math, toString, common) {\n\n  var Color = function() {\n\n    this.__state = interpret.apply(this, arguments);\n\n    if (this.__state === false) {\n      throw 'Failed to interpret color arguments';\n    }\n\n    this.__state.a = this.__state.a || 1;\n\n\n  };\n\n  Color.COMPONENTS = ['r','g','b','h','s','v','hex','a'];\n\n  common.extend(Color.prototype, {\n\n    toString: function() {\n      return toString(this);\n    },\n\n    toOriginal: function() {\n      return this.__state.conversion.write(this);\n    }\n\n  });\n\n  defineRGBComponent(Color.prototype, 'r', 2);\n  defineRGBComponent(Color.prototype, 'g', 1);\n  defineRGBComponent(Color.prototype, 'b', 0);\n\n  defineHSVComponent(Color.prototype, 'h');\n  defineHSVComponent(Color.prototype, 's');\n  defineHSVComponent(Color.prototype, 'v');\n\n  Object.defineProperty(Color.prototype, 'a', {\n\n    get: function() {\n      return this.__state.a;\n    },\n\n    set: function(v) {\n      this.__state.a = v;\n    }\n\n  });\n\n  Object.defineProperty(Color.prototype, 'hex', {\n\n    get: function() {\n\n      if (!this.__state.space !== 'HEX') {\n        this.__state.hex = math.rgb_to_hex(this.r, this.g, this.b);\n      }\n\n      return this.__state.hex;\n\n    },\n\n    set: function(v) {\n\n      this.__state.space = 'HEX';\n      this.__state.hex = v;\n\n    }\n\n  });\n\n  function defineRGBComponent(target, component, componentHexIndex) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'RGB') {\n          return this.__state[component];\n        }\n\n        recalculateRGB(this, component, componentHexIndex);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'RGB') {\n          recalculateRGB(this, component, componentHexIndex);\n          this.__state.space = 'RGB';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function defineHSVComponent(target, component) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'HSV')\n          return this.__state[component];\n\n        recalculateHSV(this);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'HSV') {\n          recalculateHSV(this);\n          this.__state.space = 'HSV';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function recalculateRGB(color, component, componentHexIndex) {\n\n    if (color.__state.space === 'HEX') {\n\n      color.__state[component] = math.component_from_hex(color.__state.hex, componentHexIndex);\n\n    } else if (color.__state.space === 'HSV') {\n\n      common.extend(color.__state, math.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n\n    } else {\n\n      throw 'Corrupted color state';\n\n    }\n\n  }\n\n  function recalculateHSV(color) {\n\n    var result = math.rgb_to_hsv(color.r, color.g, color.b);\n\n    common.extend(color.__state,\n        {\n          s: result.s,\n          v: result.v\n        }\n    );\n\n    if (!common.isNaN(result.h)) {\n      color.__state.h = result.h;\n    } else if (common.isUndefined(color.__state.h)) {\n      color.__state.h = 0;\n    }\n\n  }\n\n  return Color;\n\n})(dat.color.interpret = (function (toString, common) {\n\n  var result, toReturn;\n\n  var interpret = function() {\n\n    toReturn = false;\n\n    var original = arguments.length > 1 ? common.toArray(arguments) : arguments[0];\n\n    common.each(INTERPRETATIONS, function(family) {\n\n      if (family.litmus(original)) {\n\n        common.each(family.conversions, function(conversion, conversionName) {\n\n          result = conversion.read(original);\n\n          if (toReturn === false && result !== false) {\n            toReturn = result;\n            result.conversionName = conversionName;\n            result.conversion = conversion;\n            return common.BREAK;\n\n          }\n\n        });\n\n        return common.BREAK;\n\n      }\n\n    });\n\n    return toReturn;\n\n  };\n\n  var INTERPRETATIONS = [\n\n    // Strings\n    {\n\n      litmus: common.isString,\n\n      conversions: {\n\n        THREE_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt(\n                  '0x' +\n                      test[1].toString() + test[1].toString() +\n                      test[2].toString() + test[2].toString() +\n                      test[3].toString() + test[3].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        SIX_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9]{6})$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt('0x' + test[1].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGB: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3])\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGBA: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3]),\n              a: parseFloat(test[4])\n            };\n\n          },\n\n          write: toString\n\n        }\n\n      }\n\n    },\n\n    // Numbers\n    {\n\n      litmus: common.isNumber,\n\n      conversions: {\n\n        HEX: {\n          read: function(original) {\n            return {\n              space: 'HEX',\n              hex: original,\n              conversionName: 'HEX'\n            }\n          },\n\n          write: function(color) {\n            return color.hex;\n          }\n        }\n\n      }\n\n    },\n\n    // Arrays\n    {\n\n      litmus: common.isArray,\n\n      conversions: {\n\n        RGB_ARRAY: {\n          read: function(original) {\n            if (original.length != 3) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b];\n          }\n\n        },\n\n        RGBA_ARRAY: {\n          read: function(original) {\n            if (original.length != 4) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2],\n              a: original[3]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b, color.a];\n          }\n\n        }\n\n      }\n\n    },\n\n    // Objects\n    {\n\n      litmus: common.isObject,\n\n      conversions: {\n\n        RGBA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b,\n              a: color.a\n            }\n          }\n        },\n\n        RGB_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b\n            }\n          }\n        },\n\n        HSVA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v,\n              a: color.a\n            }\n          }\n        },\n\n        HSV_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v\n            }\n          }\n\n        }\n\n      }\n\n    }\n\n\n  ];\n\n  return interpret;\n\n\n})(dat.color.toString,\ndat.utils.common),\ndat.color.math = (function () {\n\n  var tmpComponent;\n\n  return {\n\n    hsv_to_rgb: function(h, s, v) {\n\n      var hi = Math.floor(h / 60) % 6;\n\n      var f = h / 60 - Math.floor(h / 60);\n      var p = v * (1.0 - s);\n      var q = v * (1.0 - (f * s));\n      var t = v * (1.0 - ((1.0 - f) * s));\n      var c = [\n        [v, t, p],\n        [q, v, p],\n        [p, v, t],\n        [p, q, v],\n        [t, p, v],\n        [v, p, q]\n      ][hi];\n\n      return {\n        r: c[0] * 255,\n        g: c[1] * 255,\n        b: c[2] * 255\n      };\n\n    },\n\n    rgb_to_hsv: function(r, g, b) {\n\n      var min = Math.min(r, g, b),\n          max = Math.max(r, g, b),\n          delta = max - min,\n          h, s;\n\n      if (max != 0) {\n        s = delta / max;\n      } else {\n        return {\n          h: NaN,\n          s: 0,\n          v: 0\n        };\n      }\n\n      if (r == max) {\n        h = (g - b) / delta;\n      } else if (g == max) {\n        h = 2 + (b - r) / delta;\n      } else {\n        h = 4 + (r - g) / delta;\n      }\n      h /= 6;\n      if (h < 0) {\n        h += 1;\n      }\n\n      return {\n        h: h * 360,\n        s: s,\n        v: max / 255\n      };\n    },\n\n    rgb_to_hex: function(r, g, b) {\n      var hex = this.hex_with_component(0, 2, r);\n      hex = this.hex_with_component(hex, 1, g);\n      hex = this.hex_with_component(hex, 0, b);\n      return hex;\n    },\n\n    component_from_hex: function(hex, componentIndex) {\n      return (hex >> (componentIndex * 8)) & 0xFF;\n    },\n\n    hex_with_component: function(hex, componentIndex, value) {\n      return value << (tmpComponent = componentIndex * 8) | (hex & ~ (0xFF << tmpComponent));\n    }\n\n  }\n\n})(),\ndat.color.toString,\ndat.utils.common);","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n/** @namespace */\nvar dat = module.exports = dat || {};\n\n/** @namespace */\ndat.gui = dat.gui || {};\n\n/** @namespace */\ndat.utils = dat.utils || {};\n\n/** @namespace */\ndat.controllers = dat.controllers || {};\n\n/** @namespace */\ndat.dom = dat.dom || {};\n\n/** @namespace */\ndat.color = dat.color || {};\n\ndat.utils.css = (function () {\n  return {\n    load: function (url, doc) {\n      doc = doc || document;\n      var link = doc.createElement('link');\n      link.type = 'text/css';\n      link.rel = 'stylesheet';\n      link.href = url;\n      doc.getElementsByTagName('head')[0].appendChild(link);\n    },\n    inject: function(css, doc) {\n      doc = doc || document;\n      var injected = document.createElement('style');\n      injected.type = 'text/css';\n      injected.innerHTML = css;\n      doc.getElementsByTagName('head')[0].appendChild(injected);\n    }\n  }\n})();\n\n\ndat.utils.common = (function () {\n  \n  var ARR_EACH = Array.prototype.forEach;\n  var ARR_SLICE = Array.prototype.slice;\n\n  /**\n   * Band-aid methods for things that should be a lot easier in JavaScript.\n   * Implementation and structure inspired by underscore.js\n   * http://documentcloud.github.com/underscore/\n   */\n\n  return { \n    \n    BREAK: {},\n  \n    extend: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (!this.isUndefined(obj[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n      \n    },\n    \n    defaults: function(target) {\n      \n      this.each(ARR_SLICE.call(arguments, 1), function(obj) {\n        \n        for (var key in obj)\n          if (this.isUndefined(target[key])) \n            target[key] = obj[key];\n        \n      }, this);\n      \n      return target;\n    \n    },\n    \n    compose: function() {\n      var toCall = ARR_SLICE.call(arguments);\n            return function() {\n              var args = ARR_SLICE.call(arguments);\n              for (var i = toCall.length -1; i >= 0; i--) {\n                args = [toCall[i].apply(this, args)];\n              }\n              return args[0];\n            }\n    },\n    \n    each: function(obj, itr, scope) {\n\n      \n      if (ARR_EACH && obj.forEach === ARR_EACH) { \n        \n        obj.forEach(itr, scope);\n        \n      } else if (obj.length === obj.length + 0) { // Is number but not NaN\n        \n        for (var key = 0, l = obj.length; key < l; key++)\n          if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) \n            return;\n            \n      } else {\n\n        for (var key in obj) \n          if (itr.call(scope, obj[key], key) === this.BREAK)\n            return;\n            \n      }\n            \n    },\n    \n    defer: function(fnc) {\n      setTimeout(fnc, 0);\n    },\n    \n    toArray: function(obj) {\n      if (obj.toArray) return obj.toArray();\n      return ARR_SLICE.call(obj);\n    },\n\n    isUndefined: function(obj) {\n      return obj === undefined;\n    },\n    \n    isNull: function(obj) {\n      return obj === null;\n    },\n    \n    isNaN: function(obj) {\n      return obj !== obj;\n    },\n    \n    isArray: Array.isArray || function(obj) {\n      return obj.constructor === Array;\n    },\n    \n    isObject: function(obj) {\n      return obj === Object(obj);\n    },\n    \n    isNumber: function(obj) {\n      return obj === obj+0;\n    },\n    \n    isString: function(obj) {\n      return obj === obj+'';\n    },\n    \n    isBoolean: function(obj) {\n      return obj === false || obj === true;\n    },\n    \n    isFunction: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Function]';\n    }\n  \n  };\n    \n})();\n\n\ndat.controllers.Controller = (function (common) {\n\n  /**\n   * @class An \"abstract\" class that represents a given property of an object.\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var Controller = function(object, property) {\n\n    this.initialValue = object[property];\n\n    /**\n     * Those who extend this class will put their DOM elements in here.\n     * @type {DOMElement}\n     */\n    this.domElement = document.createElement('div');\n\n    /**\n     * The object to manipulate\n     * @type {Object}\n     */\n    this.object = object;\n\n    /**\n     * The name of the property to manipulate\n     * @type {String}\n     */\n    this.property = property;\n\n    /**\n     * The function to be called on change.\n     * @type {Function}\n     * @ignore\n     */\n    this.__onChange = undefined;\n\n    /**\n     * The function to be called on finishing change.\n     * @type {Function}\n     * @ignore\n     */\n    this.__onFinishChange = undefined;\n\n  };\n\n  common.extend(\n\n      Controller.prototype,\n\n      /** @lends dat.controllers.Controller.prototype */\n      {\n\n        /**\n         * Specify that a function fire every time someone changes the value with\n         * this Controller.\n         *\n         * @param {Function} fnc This function will be called whenever the value\n         * is modified via this Controller.\n         * @returns {dat.controllers.Controller} this\n         */\n        onChange: function(fnc) {\n          this.__onChange = fnc;\n          return this;\n        },\n\n        /**\n         * Specify that a function fire every time someone \"finishes\" changing\n         * the value wih this Controller. Useful for values that change\n         * incrementally like numbers or strings.\n         *\n         * @param {Function} fnc This function will be called whenever\n         * someone \"finishes\" changing the value via this Controller.\n         * @returns {dat.controllers.Controller} this\n         */\n        onFinishChange: function(fnc) {\n          this.__onFinishChange = fnc;\n          return this;\n        },\n\n        /**\n         * Change the value of <code>object[property]</code>\n         *\n         * @param {Object} newValue The new value of <code>object[property]</code>\n         */\n        setValue: function(newValue) {\n          this.object[this.property] = newValue;\n          if (this.__onChange) {\n            this.__onChange.call(this, newValue);\n          }\n          this.updateDisplay();\n          return this;\n        },\n\n        /**\n         * Gets the value of <code>object[property]</code>\n         *\n         * @returns {Object} The current value of <code>object[property]</code>\n         */\n        getValue: function() {\n          return this.object[this.property];\n        },\n\n        /**\n         * Refreshes the visual display of a Controller in order to keep sync\n         * with the object's current value.\n         * @returns {dat.controllers.Controller} this\n         */\n        updateDisplay: function() {\n          return this;\n        },\n\n        /**\n         * @returns {Boolean} true if the value has deviated from initialValue\n         */\n        isModified: function() {\n          return this.initialValue !== this.getValue()\n        }\n\n      }\n\n  );\n\n  return Controller;\n\n\n})(dat.utils.common);\n\n\ndat.dom.dom = (function (common) {\n\n  var EVENT_MAP = {\n    'HTMLEvents': ['change'],\n    'MouseEvents': ['click','mousemove','mousedown','mouseup', 'mouseover'],\n    'KeyboardEvents': ['keydown']\n  };\n\n  var EVENT_MAP_INV = {};\n  common.each(EVENT_MAP, function(v, k) {\n    common.each(v, function(e) {\n      EVENT_MAP_INV[e] = k;\n    });\n  });\n\n  var CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\n\n  function cssValueToPixels(val) {\n\n    if (val === '0' || common.isUndefined(val)) return 0;\n\n    var match = val.match(CSS_VALUE_PIXELS);\n\n    if (!common.isNull(match)) {\n      return parseFloat(match[1]);\n    }\n\n    // TODO ...ems? %?\n\n    return 0;\n\n  }\n\n  /**\n   * @namespace\n   * @member dat.dom\n   */\n  var dom = {\n\n    /**\n     * \n     * @param elem\n     * @param selectable\n     */\n    makeSelectable: function(elem, selectable) {\n\n      if (elem === undefined || elem.style === undefined) return;\n\n      elem.onselectstart = selectable ? function() {\n        return false;\n      } : function() {\n      };\n\n      elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n      elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n      elem.unselectable = selectable ? 'on' : 'off';\n\n    },\n\n    /**\n     *\n     * @param elem\n     * @param horizontal\n     * @param vertical\n     */\n    makeFullscreen: function(elem, horizontal, vertical) {\n\n      if (common.isUndefined(horizontal)) horizontal = true;\n      if (common.isUndefined(vertical)) vertical = true;\n\n      elem.style.position = 'absolute';\n\n      if (horizontal) {\n        elem.style.left = 0;\n        elem.style.right = 0;\n      }\n      if (vertical) {\n        elem.style.top = 0;\n        elem.style.bottom = 0;\n      }\n\n    },\n\n    /**\n     *\n     * @param elem\n     * @param eventType\n     * @param params\n     */\n    fakeEvent: function(elem, eventType, params, aux) {\n      params = params || {};\n      var className = EVENT_MAP_INV[eventType];\n      if (!className) {\n        throw new Error('Event type ' + eventType + ' not supported.');\n      }\n      var evt = document.createEvent(className);\n      switch (className) {\n        case 'MouseEvents':\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false,\n              params.cancelable || true, window, params.clickCount || 1,\n              0, //screen X\n              0, //screen Y\n              clientX, //client X\n              clientY, //client Y\n              false, false, false, false, 0, null);\n          break;\n        case 'KeyboardEvents':\n          var init = evt.initKeyboardEvent || evt.initKeyEvent; // webkit || moz\n          common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false,\n              params.cancelable, window,\n              params.ctrlKey, params.altKey,\n              params.shiftKey, params.metaKey,\n              params.keyCode, params.charCode);\n          break;\n        default:\n          evt.initEvent(eventType, params.bubbles || false,\n              params.cancelable || true);\n          break;\n      }\n      common.defaults(evt, aux);\n      elem.dispatchEvent(evt);\n    },\n\n    /**\n     *\n     * @param elem\n     * @param event\n     * @param func\n     * @param bool\n     */\n    bind: function(elem, event, func, bool) {\n      bool = bool || false;\n      if (elem.addEventListener)\n        elem.addEventListener(event, func, bool);\n      else if (elem.attachEvent)\n        elem.attachEvent('on' + event, func);\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param event\n     * @param func\n     * @param bool\n     */\n    unbind: function(elem, event, func, bool) {\n      bool = bool || false;\n      if (elem.removeEventListener)\n        elem.removeEventListener(event, func, bool);\n      else if (elem.detachEvent)\n        elem.detachEvent('on' + event, func);\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param className\n     */\n    addClass: function(elem, className) {\n      if (elem.className === undefined) {\n        elem.className = className;\n      } else if (elem.className !== className) {\n        var classes = elem.className.split(/ +/);\n        if (classes.indexOf(className) == -1) {\n          classes.push(className);\n          elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n        }\n      }\n      return dom;\n    },\n\n    /**\n     *\n     * @param elem\n     * @param className\n     */\n    removeClass: function(elem, className) {\n      if (className) {\n        if (elem.className === undefined) {\n          // elem.className = className;\n        } else if (elem.className === className) {\n          elem.removeAttribute('class');\n        } else {\n          var classes = elem.className.split(/ +/);\n          var index = classes.indexOf(className);\n          if (index != -1) {\n            classes.splice(index, 1);\n            elem.className = classes.join(' ');\n          }\n        }\n      } else {\n        elem.className = undefined;\n      }\n      return dom;\n    },\n\n    hasClass: function(elem, className) {\n      return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getWidth: function(elem) {\n\n      var style = getComputedStyle(elem);\n\n      return cssValueToPixels(style['border-left-width']) +\n          cssValueToPixels(style['border-right-width']) +\n          cssValueToPixels(style['padding-left']) +\n          cssValueToPixels(style['padding-right']) +\n          cssValueToPixels(style['width']);\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getHeight: function(elem) {\n\n      var style = getComputedStyle(elem);\n\n      return cssValueToPixels(style['border-top-width']) +\n          cssValueToPixels(style['border-bottom-width']) +\n          cssValueToPixels(style['padding-top']) +\n          cssValueToPixels(style['padding-bottom']) +\n          cssValueToPixels(style['height']);\n    },\n\n    /**\n     *\n     * @param elem\n     */\n    getOffset: function(elem) {\n      var offset = {left: 0, top:0};\n      if (elem.offsetParent) {\n        do {\n          offset.left += elem.offsetLeft;\n          offset.top += elem.offsetTop;\n        } while (elem = elem.offsetParent);\n      }\n      return offset;\n    },\n\n    // http://stackoverflow.com/posts/2684561/revisions\n    /**\n     * \n     * @param elem\n     */\n    isActive: function(elem) {\n      return elem === document.activeElement && ( elem.type || elem.href );\n    }\n\n  };\n\n  return dom;\n\n})(dat.utils.common);\n\n\ndat.controllers.OptionController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a select input to alter the property of an object, using a\n   * list of accepted values.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object|string[]} options A map of labels to acceptable values, or\n   * a list of acceptable string values.\n   *\n   * @member dat.controllers\n   */\n  var OptionController = function(object, property, options) {\n\n    OptionController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    /**\n     * The drop down menu\n     * @ignore\n     */\n    this.__select = document.createElement('select');\n\n    if (common.isArray(options)) {\n      var map = {};\n      common.each(options, function(element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n\n    common.each(options, function(value, key) {\n\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n\n    });\n\n    // Acknowledge original value\n    this.updateDisplay();\n\n    dom.bind(this.__select, 'change', function() {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n\n    this.domElement.appendChild(this.__select);\n\n  };\n\n  OptionController.superclass = Controller;\n\n  common.extend(\n\n      OptionController.prototype,\n      Controller.prototype,\n\n      {\n\n        setValue: function(v) {\n          var toReturn = OptionController.superclass.prototype.setValue.call(this, v);\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          return toReturn;\n        },\n\n        updateDisplay: function() {\n          this.__select.value = this.getValue();\n          return OptionController.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  return OptionController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.NumberController = (function (Controller, common) {\n\n  /**\n   * @class Represents a given property of an object that is a number.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object} [params] Optional parameters\n   * @param {Number} [params.min] Minimum allowed value\n   * @param {Number} [params.max] Maximum allowed value\n   * @param {Number} [params.step] Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberController = function(object, property, params) {\n\n    NumberController.superclass.call(this, object, property);\n\n    params = params || {};\n\n    this.__min = params.min;\n    this.__max = params.max;\n    this.__step = params.step;\n\n    if (common.isUndefined(this.__step)) {\n\n      if (this.initialValue == 0) {\n        this.__impliedStep = 1; // What are we, psychics?\n      } else {\n        // Hey Doug, check this out.\n        this.__impliedStep = Math.pow(10, Math.floor(Math.log(this.initialValue)/Math.LN10))/10;\n      }\n\n    } else {\n\n      this.__impliedStep = this.__step;\n\n    }\n\n    this.__precision = numDecimals(this.__impliedStep);\n\n\n  };\n\n  NumberController.superclass = Controller;\n\n  common.extend(\n\n      NumberController.prototype,\n      Controller.prototype,\n\n      /** @lends dat.controllers.NumberController.prototype */\n      {\n\n        setValue: function(v) {\n\n          if (this.__min !== undefined && v < this.__min) {\n            v = this.__min;\n          } else if (this.__max !== undefined && v > this.__max) {\n            v = this.__max;\n          }\n\n          if (this.__step !== undefined && v % this.__step != 0) {\n            v = Math.round(v / this.__step) * this.__step;\n          }\n\n          return NumberController.superclass.prototype.setValue.call(this, v);\n\n        },\n\n        /**\n         * Specify a minimum value for <code>object[property]</code>.\n         *\n         * @param {Number} minValue The minimum value for\n         * <code>object[property]</code>\n         * @returns {dat.controllers.NumberController} this\n         */\n        min: function(v) {\n          this.__min = v;\n          return this;\n        },\n\n        /**\n         * Specify a maximum value for <code>object[property]</code>.\n         *\n         * @param {Number} maxValue The maximum value for\n         * <code>object[property]</code>\n         * @returns {dat.controllers.NumberController} this\n         */\n        max: function(v) {\n          this.__max = v;\n          return this;\n        },\n\n        /**\n         * Specify a step value that dat.controllers.NumberController\n         * increments by.\n         *\n         * @param {Number} stepValue The step value for\n         * dat.controllers.NumberController\n         * @default if minimum and maximum specified increment is 1% of the\n         * difference otherwise stepValue is 1\n         * @returns {dat.controllers.NumberController} this\n         */\n        step: function(v) {\n          this.__step = v;\n          return this;\n        }\n\n      }\n\n  );\n\n  function numDecimals(x) {\n    x = x.toString();\n    if (x.indexOf('.') > -1) {\n      return x.length - x.indexOf('.') - 1;\n    } else {\n      return 0;\n    }\n  }\n\n  return NumberController;\n\n})(dat.controllers.Controller,\ndat.utils.common);\n\n\ndat.controllers.NumberControllerBox = (function (NumberController, dom, common) {\n\n  /**\n   * @class Represents a given property of an object that is a number and\n   * provides an input element with which to manipulate it.\n   *\n   * @extends dat.controllers.Controller\n   * @extends dat.controllers.NumberController\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Object} [params] Optional parameters\n   * @param {Number} [params.min] Minimum allowed value\n   * @param {Number} [params.max] Maximum allowed value\n   * @param {Number} [params.step] Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberControllerBox = function(object, property, params) {\n\n    this.__truncationSuspended = false;\n\n    NumberControllerBox.superclass.call(this, object, property, params);\n\n    var _this = this;\n\n    /**\n     * {Number} Previous mouse y position\n     * @ignore\n     */\n    var prev_y;\n\n    this.__input = document.createElement('input');\n    this.__input.setAttribute('type', 'text');\n\n    // Makes it so manually specified values are not truncated.\n\n    dom.bind(this.__input, 'change', onChange);\n    dom.bind(this.__input, 'blur', onBlur);\n    dom.bind(this.__input, 'mousedown', onMouseDown);\n    dom.bind(this.__input, 'keydown', function(e) {\n\n      // When pressing entire, you can be as precise as you want.\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n      }\n\n    });\n\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!common.isNaN(attempted)) _this.setValue(attempted);\n    }\n\n    function onBlur() {\n      onChange();\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prev_y = e.clientY;\n    }\n\n    function onMouseDrag(e) {\n\n      var diff = prev_y - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n\n      prev_y = e.clientY;\n\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n    }\n\n    this.updateDisplay();\n\n    this.domElement.appendChild(this.__input);\n\n  };\n\n  NumberControllerBox.superclass = NumberController;\n\n  common.extend(\n\n      NumberControllerBox.prototype,\n      NumberController.prototype,\n\n      {\n\n        updateDisplay: function() {\n\n          this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n          return NumberControllerBox.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  function roundToDecimal(value, decimals) {\n    var tenTo = Math.pow(10, decimals);\n    return Math.round(value * tenTo) / tenTo;\n  }\n\n  return NumberControllerBox;\n\n})(dat.controllers.NumberController,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.NumberControllerSlider = (function (NumberController, dom, css, common, styleSheet) {\n\n  /**\n   * @class Represents a given property of an object that is a number, contains\n   * a minimum and maximum, and provides a slider element with which to\n   * manipulate it. It should be noted that the slider element is made up of\n   * <code>&lt;div&gt;</code> tags, <strong>not</strong> the html5\n   * <code>&lt;slider&gt;</code> element.\n   *\n   * @extends dat.controllers.Controller\n   * @extends dat.controllers.NumberController\n   * \n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   * @param {Number} minValue Minimum allowed value\n   * @param {Number} maxValue Maximum allowed value\n   * @param {Number} stepValue Increment by which to change value\n   *\n   * @member dat.controllers\n   */\n  var NumberControllerSlider = function(object, property, min, max, step) {\n\n    NumberControllerSlider.superclass.call(this, object, property, { min: min, max: max, step: step });\n\n    var _this = this;\n\n    this.__background = document.createElement('div');\n    this.__foreground = document.createElement('div');\n    \n\n\n    dom.bind(this.__background, 'mousedown', onMouseDown);\n    \n    dom.addClass(this.__background, 'slider');\n    dom.addClass(this.__foreground, 'slider-fg');\n\n    function onMouseDown(e) {\n\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n\n      onMouseDrag(e);\n    }\n\n    function onMouseDrag(e) {\n\n      e.preventDefault();\n\n      var offset = dom.getOffset(_this.__background);\n      var width = dom.getWidth(_this.__background);\n      \n      _this.setValue(\n        map(e.clientX, offset.left, offset.left + width, _this.__min, _this.__max)\n      );\n\n      return false;\n\n    }\n\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    this.updateDisplay();\n\n    this.__background.appendChild(this.__foreground);\n    this.domElement.appendChild(this.__background);\n\n  };\n\n  NumberControllerSlider.superclass = NumberController;\n\n  /**\n   * Injects default stylesheet for slider elements.\n   */\n  NumberControllerSlider.useDefaultStyles = function() {\n    css.inject(styleSheet);\n  };\n\n  common.extend(\n\n      NumberControllerSlider.prototype,\n      NumberController.prototype,\n\n      {\n\n        updateDisplay: function() {\n          var pct = (this.getValue() - this.__min)/(this.__max - this.__min);\n          this.__foreground.style.width = pct*100+'%';\n          return NumberControllerSlider.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n\n\n  );\n\n  function map(v, i1, i2, o1, o2) {\n    return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n  }\n\n  return NumberControllerSlider;\n  \n})(dat.controllers.NumberController,\ndat.dom.dom,\ndat.utils.css,\ndat.utils.common,\n\".slider {\\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\\n  height: 1em;\\n  border-radius: 1em;\\n  background-color: #eee;\\n  padding: 0 0.5em;\\n  overflow: hidden;\\n}\\n\\n.slider-fg {\\n  padding: 1px 0 2px 0;\\n  background-color: #aaa;\\n  height: 1em;\\n  margin-left: -0.5em;\\n  padding-right: 0.5em;\\n  border-radius: 1em 0 0 1em;\\n}\\n\\n.slider-fg:after {\\n  display: inline-block;\\n  border-radius: 1em;\\n  background-color: #fff;\\n  border:  1px solid #aaa;\\n  content: '';\\n  float: right;\\n  margin-right: -1em;\\n  margin-top: -1px;\\n  height: 0.9em;\\n  width: 0.9em;\\n}\");\n\n\ndat.controllers.FunctionController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a GUI interface to fire a specified method, a property of an object.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var FunctionController = function(object, property, text) {\n\n    FunctionController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    this.__button = document.createElement('div');\n    this.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(this.__button, 'click', function(e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n\n    dom.addClass(this.__button, 'button');\n\n    this.domElement.appendChild(this.__button);\n\n\n  };\n\n  FunctionController.superclass = Controller;\n\n  common.extend(\n\n      FunctionController.prototype,\n      Controller.prototype,\n      {\n        \n        fire: function() {\n          if (this.__onChange) {\n            this.__onChange.call(this);\n          }\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          this.getValue().call(this.object);\n        }\n      }\n\n  );\n\n  return FunctionController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.controllers.BooleanController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a checkbox input to alter the boolean property of an object.\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var BooleanController = function(object, property) {\n\n    BooleanController.superclass.call(this, object, property);\n\n    var _this = this;\n    this.__prev = this.getValue();\n\n    this.__checkbox = document.createElement('input');\n    this.__checkbox.setAttribute('type', 'checkbox');\n\n\n    dom.bind(this.__checkbox, 'change', onChange, false);\n\n    this.domElement.appendChild(this.__checkbox);\n\n    // Match original value\n    this.updateDisplay();\n\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n\n  };\n\n  BooleanController.superclass = Controller;\n\n  common.extend(\n\n      BooleanController.prototype,\n      Controller.prototype,\n\n      {\n\n        setValue: function(v) {\n          var toReturn = BooleanController.superclass.prototype.setValue.call(this, v);\n          if (this.__onFinishChange) {\n            this.__onFinishChange.call(this, this.getValue());\n          }\n          this.__prev = this.getValue();\n          return toReturn;\n        },\n\n        updateDisplay: function() {\n          \n          if (this.getValue() === true) {\n            this.__checkbox.setAttribute('checked', 'checked');\n            this.__checkbox.checked = true;    \n          } else {\n              this.__checkbox.checked = false;\n          }\n\n          return BooleanController.superclass.prototype.updateDisplay.call(this);\n\n        }\n\n\n      }\n\n  );\n\n  return BooleanController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common);\n\n\ndat.color.toString = (function (common) {\n\n  return function(color) {\n\n    if (color.a == 1 || common.isUndefined(color.a)) {\n\n      var s = color.hex.toString(16);\n      while (s.length < 6) {\n        s = '0' + s;\n      }\n\n      return '#' + s;\n\n    } else {\n\n      return 'rgba(' + Math.round(color.r) + ',' + Math.round(color.g) + ',' + Math.round(color.b) + ',' + color.a + ')';\n\n    }\n\n  }\n\n})(dat.utils.common);\n\n\ndat.color.interpret = (function (toString, common) {\n\n  var result, toReturn;\n\n  var interpret = function() {\n\n    toReturn = false;\n\n    var original = arguments.length > 1 ? common.toArray(arguments) : arguments[0];\n\n    common.each(INTERPRETATIONS, function(family) {\n\n      if (family.litmus(original)) {\n\n        common.each(family.conversions, function(conversion, conversionName) {\n\n          result = conversion.read(original);\n\n          if (toReturn === false && result !== false) {\n            toReturn = result;\n            result.conversionName = conversionName;\n            result.conversion = conversion;\n            return common.BREAK;\n\n          }\n\n        });\n\n        return common.BREAK;\n\n      }\n\n    });\n\n    return toReturn;\n\n  };\n\n  var INTERPRETATIONS = [\n\n    // Strings\n    {\n\n      litmus: common.isString,\n\n      conversions: {\n\n        THREE_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt(\n                  '0x' +\n                      test[1].toString() + test[1].toString() +\n                      test[2].toString() + test[2].toString() +\n                      test[3].toString() + test[3].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        SIX_CHAR_HEX: {\n\n          read: function(original) {\n\n            var test = original.match(/^#([A-F0-9]{6})$/i);\n            if (test === null) return false;\n\n            return {\n              space: 'HEX',\n              hex: parseInt('0x' + test[1].toString())\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGB: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3])\n            };\n\n          },\n\n          write: toString\n\n        },\n\n        CSS_RGBA: {\n\n          read: function(original) {\n\n            var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\,\\s*(.+)\\s*\\)/);\n            if (test === null) return false;\n\n            return {\n              space: 'RGB',\n              r: parseFloat(test[1]),\n              g: parseFloat(test[2]),\n              b: parseFloat(test[3]),\n              a: parseFloat(test[4])\n            };\n\n          },\n\n          write: toString\n\n        }\n\n      }\n\n    },\n\n    // Numbers\n    {\n\n      litmus: common.isNumber,\n\n      conversions: {\n\n        HEX: {\n          read: function(original) {\n            return {\n              space: 'HEX',\n              hex: original,\n              conversionName: 'HEX'\n            }\n          },\n\n          write: function(color) {\n            return color.hex;\n          }\n        }\n\n      }\n\n    },\n\n    // Arrays\n    {\n\n      litmus: common.isArray,\n\n      conversions: {\n\n        RGB_ARRAY: {\n          read: function(original) {\n            if (original.length != 3) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b];\n          }\n\n        },\n\n        RGBA_ARRAY: {\n          read: function(original) {\n            if (original.length != 4) return false;\n            return {\n              space: 'RGB',\n              r: original[0],\n              g: original[1],\n              b: original[2],\n              a: original[3]\n            };\n          },\n\n          write: function(color) {\n            return [color.r, color.g, color.b, color.a];\n          }\n\n        }\n\n      }\n\n    },\n\n    // Objects\n    {\n\n      litmus: common.isObject,\n\n      conversions: {\n\n        RGBA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b,\n              a: color.a\n            }\n          }\n        },\n\n        RGB_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.r) &&\n                common.isNumber(original.g) &&\n                common.isNumber(original.b)) {\n              return {\n                space: 'RGB',\n                r: original.r,\n                g: original.g,\n                b: original.b\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              r: color.r,\n              g: color.g,\n              b: color.b\n            }\n          }\n        },\n\n        HSVA_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v) &&\n                common.isNumber(original.a)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v,\n                a: original.a\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v,\n              a: color.a\n            }\n          }\n        },\n\n        HSV_OBJ: {\n          read: function(original) {\n            if (common.isNumber(original.h) &&\n                common.isNumber(original.s) &&\n                common.isNumber(original.v)) {\n              return {\n                space: 'HSV',\n                h: original.h,\n                s: original.s,\n                v: original.v\n              }\n            }\n            return false;\n          },\n\n          write: function(color) {\n            return {\n              h: color.h,\n              s: color.s,\n              v: color.v\n            }\n          }\n\n        }\n\n      }\n\n    }\n\n\n  ];\n\n  return interpret;\n\n\n})(dat.color.toString,\ndat.utils.common);\n\n\ndat.GUI = dat.gui.GUI = (function (css, saveDialogueContents, styleSheet, controllerFactory, Controller, BooleanController, FunctionController, NumberControllerBox, NumberControllerSlider, OptionController, ColorController, requestAnimationFrame, CenteredDiv, dom, common) {\n\n  css.inject(styleSheet);\n\n  /** Outer-most className for GUI's */\n  var CSS_NAMESPACE = 'dg';\n\n  var HIDE_KEY_CODE = 72;\n\n  /** The only value shared between the JS and SCSS. Use caution. */\n  var CLOSE_BUTTON_HEIGHT = 20;\n\n  var DEFAULT_DEFAULT_PRESET_NAME = 'Default';\n\n  var SUPPORTS_LOCAL_STORAGE = (function() {\n    try {\n      return 'localStorage' in window && window['localStorage'] !== null;\n    } catch (e) {\n      return false;\n    }\n  })();\n\n  var SAVE_DIALOGUE;\n\n  /** Have we yet to create an autoPlace GUI? */\n  var auto_place_virgin = true;\n\n  /** Fixed position div that auto place GUI's go inside */\n  var auto_place_container;\n\n  /** Are we hiding the GUI's ? */\n  var hide = false;\n\n  /** GUI's which should be hidden */\n  var hideable_guis = [];\n\n  /**\n   * A lightweight controller library for JavaScript. It allows you to easily\n   * manipulate variables and fire functions on the fly.\n   * @class\n   *\n   * @member dat.gui\n   *\n   * @param {Object} [params]\n   * @param {String} [params.name] The name of this GUI.\n   * @param {Object} [params.load] JSON object representing the saved state of\n   * this GUI.\n   * @param {Boolean} [params.auto=true]\n   * @param {dat.gui.GUI} [params.parent] The GUI I'm nested in.\n   * @param {Boolean} [params.closed] If true, starts closed\n   */\n  var GUI = function(params) {\n\n    var _this = this;\n\n    /**\n     * Outermost DOM Element\n     * @type DOMElement\n     */\n    this.domElement = document.createElement('div');\n    this.__ul = document.createElement('ul');\n    this.domElement.appendChild(this.__ul);\n\n    dom.addClass(this.domElement, CSS_NAMESPACE);\n\n    /**\n     * Nested GUI's by name\n     * @ignore\n     */\n    this.__folders = {};\n\n    this.__controllers = [];\n\n    /**\n     * List of objects I'm remembering for save, only used in top level GUI\n     * @ignore\n     */\n    this.__rememberedObjects = [];\n\n    /**\n     * Maps the index of remembered objects to a map of controllers, only used\n     * in top level GUI.\n     *\n     * @private\n     * @ignore\n     *\n     * @example\n     * [\n     *  {\n     *    propertyName: Controller,\n     *    anotherPropertyName: Controller\n     *  },\n     *  {\n     *    propertyName: Controller\n     *  }\n     * ]\n     */\n    this.__rememberedObjectIndecesToControllers = [];\n\n    this.__listening = [];\n\n    params = params || {};\n\n    // Default parameters\n    params = common.defaults(params, {\n      autoPlace: true,\n      width: GUI.DEFAULT_WIDTH\n    });\n\n    params = common.defaults(params, {\n      resizable: params.autoPlace,\n      hideable: params.autoPlace\n    });\n\n\n    if (!common.isUndefined(params.load)) {\n\n      // Explicit preset\n      if (params.preset) params.load.preset = params.preset;\n\n    } else {\n\n      params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n\n    }\n\n    if (common.isUndefined(params.parent) && params.hideable) {\n      hideable_guis.push(this);\n    }\n\n    // Only root level GUI's are resizable.\n    params.resizable = common.isUndefined(params.parent) && params.resizable;\n\n\n    if (params.autoPlace && common.isUndefined(params.scrollable)) {\n      params.scrollable = true;\n    }\n//    params.scrollable = common.isUndefined(params.parent) && params.scrollable === true;\n\n    // Not part of params because I don't want people passing this in via\n    // constructor. Should be a 'remembered' value.\n    var use_local_storage =\n        SUPPORTS_LOCAL_STORAGE &&\n            localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n\n    Object.defineProperties(this,\n\n        /** @lends dat.gui.GUI.prototype */\n        {\n\n          /**\n           * The parent <code>GUI</code>\n           * @type dat.gui.GUI\n           */\n          parent: {\n            get: function() {\n              return params.parent;\n            }\n          },\n\n          scrollable: {\n            get: function() {\n              return params.scrollable;\n            }\n          },\n\n          /**\n           * Handles <code>GUI</code>'s element placement for you\n           * @type Boolean\n           */\n          autoPlace: {\n            get: function() {\n              return params.autoPlace;\n            }\n          },\n\n          /**\n           * The identifier for a set of saved values\n           * @type String\n           */\n          preset: {\n\n            get: function() {\n              if (_this.parent) {\n                return _this.getRoot().preset;\n              } else {\n                return params.load.preset;\n              }\n            },\n\n            set: function(v) {\n              if (_this.parent) {\n                _this.getRoot().preset = v;\n              } else {\n                params.load.preset = v;\n              }\n              setPresetSelectIndex(this);\n              _this.revert();\n            }\n\n          },\n\n          /**\n           * The width of <code>GUI</code> element\n           * @type Number\n           */\n          width: {\n            get: function() {\n              return params.width;\n            },\n            set: function(v) {\n              params.width = v;\n              setWidth(_this, v);\n            }\n          },\n\n          /**\n           * The name of <code>GUI</code>. Used for folders. i.e\n           * a folder's name\n           * @type String\n           */\n          name: {\n            get: function() {\n              return params.name;\n            },\n            set: function(v) {\n              // TODO Check for collisions among sibling folders\n              params.name = v;\n              if (title_row_name) {\n                title_row_name.innerHTML = params.name;\n              }\n            }\n          },\n\n          /**\n           * Whether the <code>GUI</code> is collapsed or not\n           * @type Boolean\n           */\n          closed: {\n            get: function() {\n              return params.closed;\n            },\n            set: function(v) {\n              params.closed = v;\n              if (params.closed) {\n                dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n              } else {\n                dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n              }\n              // For browsers that aren't going to respect the CSS transition,\n              // Lets just check our height against the window height right off\n              // the bat.\n              this.onResize();\n\n              if (_this.__closeButton) {\n                _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n              }\n            }\n          },\n\n          /**\n           * Contains all presets\n           * @type Object\n           */\n          load: {\n            get: function() {\n              return params.load;\n            }\n          },\n\n          /**\n           * Determines whether or not to use <a href=\"https://developer.mozilla.org/en/DOM/Storage#localStorage\">localStorage</a> as the means for\n           * <code>remember</code>ing\n           * @type Boolean\n           */\n          useLocalStorage: {\n\n            get: function() {\n              return use_local_storage;\n            },\n            set: function(bool) {\n              if (SUPPORTS_LOCAL_STORAGE) {\n                use_local_storage = bool;\n                if (bool) {\n                  dom.bind(window, 'unload', saveToLocalStorage);\n                } else {\n                  dom.unbind(window, 'unload', saveToLocalStorage);\n                }\n                localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n              }\n            }\n\n          }\n\n        });\n\n    // Are we a root level GUI?\n    if (common.isUndefined(params.parent)) {\n\n      params.closed = false;\n\n      dom.addClass(this.domElement, GUI.CLASS_MAIN);\n      dom.makeSelectable(this.domElement, false);\n\n      // Are we supposed to be loading locally?\n      if (SUPPORTS_LOCAL_STORAGE) {\n\n        if (use_local_storage) {\n\n          _this.useLocalStorage = true;\n\n          var saved_gui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n\n          if (saved_gui) {\n            params.load = JSON.parse(saved_gui);\n          }\n\n        }\n\n      }\n\n      this.__closeButton = document.createElement('div');\n      this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n      this.domElement.appendChild(this.__closeButton);\n\n      dom.bind(this.__closeButton, 'click', function() {\n\n        _this.closed = !_this.closed;\n\n\n      });\n\n\n      // Oh, you're a nested GUI!\n    } else {\n\n      if (params.closed === undefined) {\n        params.closed = true;\n      }\n\n      var title_row_name = document.createTextNode(params.name);\n      dom.addClass(title_row_name, 'controller-name');\n\n      var title_row = addRow(_this, title_row_name);\n\n      var on_click_title = function(e) {\n        e.preventDefault();\n        _this.closed = !_this.closed;\n        return false;\n      };\n\n      dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n\n      dom.addClass(title_row, 'title');\n      dom.bind(title_row, 'click', on_click_title);\n\n      if (!params.closed) {\n        this.closed = false;\n      }\n\n    }\n\n    if (params.autoPlace) {\n\n      if (common.isUndefined(params.parent)) {\n\n        if (auto_place_virgin) {\n          auto_place_container = document.createElement('div');\n          dom.addClass(auto_place_container, CSS_NAMESPACE);\n          dom.addClass(auto_place_container, GUI.CLASS_AUTO_PLACE_CONTAINER);\n          document.body.appendChild(auto_place_container);\n          auto_place_virgin = false;\n        }\n\n        // Put it in the dom for you.\n        auto_place_container.appendChild(this.domElement);\n\n        // Apply the auto styles\n        dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n\n      }\n\n\n      // Make it not elastic.\n      if (!this.parent) setWidth(_this, params.width);\n\n    }\n\n    dom.bind(window, 'resize', function() { _this.onResize() });\n    dom.bind(this.__ul, 'webkitTransitionEnd', function() { _this.onResize(); });\n    dom.bind(this.__ul, 'transitionend', function() { _this.onResize() });\n    dom.bind(this.__ul, 'oTransitionEnd', function() { _this.onResize() });\n    this.onResize();\n\n\n    if (params.resizable) {\n      addResizeHandle(this);\n    }\n\n    function saveToLocalStorage() {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n\n    var root = _this.getRoot();\n    function resetWidth() {\n        var root = _this.getRoot();\n        root.width += 1;\n        common.defer(function() {\n          root.width -= 1;\n        });\n      }\n\n      if (!params.parent) {\n        resetWidth();\n      }\n\n  };\n\n  GUI.toggleHide = function() {\n\n    hide = !hide;\n    common.each(hideable_guis, function(gui) {\n      gui.domElement.style.zIndex = hide ? -999 : 999;\n      gui.domElement.style.opacity = hide ? 0 : 1;\n    });\n  };\n\n  GUI.CLASS_AUTO_PLACE = 'a';\n  GUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\n  GUI.CLASS_MAIN = 'main';\n  GUI.CLASS_CONTROLLER_ROW = 'cr';\n  GUI.CLASS_TOO_TALL = 'taller-than-window';\n  GUI.CLASS_CLOSED = 'closed';\n  GUI.CLASS_CLOSE_BUTTON = 'close-button';\n  GUI.CLASS_DRAG = 'drag';\n\n  GUI.DEFAULT_WIDTH = 245;\n  GUI.TEXT_CLOSED = 'Close Controls';\n  GUI.TEXT_OPEN = 'Open Controls';\n\n  dom.bind(window, 'keydown', function(e) {\n\n    if (document.activeElement.type !== 'text' &&\n        (e.which === HIDE_KEY_CODE || e.keyCode == HIDE_KEY_CODE)) {\n      GUI.toggleHide();\n    }\n\n  }, false);\n\n  common.extend(\n\n      GUI.prototype,\n\n      /** @lends dat.gui.GUI */\n      {\n\n        /**\n         * @param object\n         * @param property\n         * @returns {dat.controllers.Controller} The new controller that was added.\n         * @instance\n         */\n        add: function(object, property) {\n\n          return add(\n              this,\n              object,\n              property,\n              {\n                factoryArgs: Array.prototype.slice.call(arguments, 2)\n              }\n          );\n\n        },\n\n        /**\n         * @param object\n         * @param property\n         * @returns {dat.controllers.ColorController} The new controller that was added.\n         * @instance\n         */\n        addColor: function(object, property) {\n\n          return add(\n              this,\n              object,\n              property,\n              {\n                color: true\n              }\n          );\n\n        },\n\n        /**\n         * @param controller\n         * @instance\n         */\n        remove: function(controller) {\n\n          // TODO listening?\n          this.__ul.removeChild(controller.__li);\n          this.__controllers.slice(this.__controllers.indexOf(controller), 1);\n          var _this = this;\n          common.defer(function() {\n            _this.onResize();\n          });\n\n        },\n\n        destroy: function() {\n\n          if (this.autoPlace) {\n            auto_place_container.removeChild(this.domElement);\n          }\n\n        },\n\n        /**\n         * @param name\n         * @returns {dat.gui.GUI} The new folder.\n         * @throws {Error} if this GUI already has a folder by the specified\n         * name\n         * @instance\n         */\n        addFolder: function(name) {\n\n          // We have to prevent collisions on names in order to have a key\n          // by which to remember saved values\n          if (this.__folders[name] !== undefined) {\n            throw new Error('You already have a folder in this GUI by the' +\n                ' name \"' + name + '\"');\n          }\n\n          var new_gui_params = { name: name, parent: this };\n\n          // We need to pass down the autoPlace trait so that we can\n          // attach event listeners to open/close folder actions to\n          // ensure that a scrollbar appears if the window is too short.\n          new_gui_params.autoPlace = this.autoPlace;\n\n          // Do we have saved appearance data for this folder?\n\n          if (this.load && // Anything loaded?\n              this.load.folders && // Was my parent a dead-end?\n              this.load.folders[name]) { // Did daddy remember me?\n\n            // Start me closed if I was closed\n            new_gui_params.closed = this.load.folders[name].closed;\n\n            // Pass down the loaded data\n            new_gui_params.load = this.load.folders[name];\n\n          }\n\n          var gui = new GUI(new_gui_params);\n          this.__folders[name] = gui;\n\n          var li = addRow(this, gui.domElement);\n          dom.addClass(li, 'folder');\n          return gui;\n\n        },\n\n        open: function() {\n          this.closed = false;\n        },\n\n        close: function() {\n          this.closed = true;\n        },\n\n        onResize: function() {\n\n          var root = this.getRoot();\n\n          if (root.scrollable) {\n\n            var top = dom.getOffset(root.__ul).top;\n            var h = 0;\n\n            common.each(root.__ul.childNodes, function(node) {\n              if (! (root.autoPlace && node === root.__save_row))\n                h += dom.getHeight(node);\n            });\n\n            if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n              dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n              root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n            } else {\n              dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n              root.__ul.style.height = 'auto';\n            }\n\n          }\n\n          if (root.__resize_handle) {\n            common.defer(function() {\n              root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n            });\n          }\n\n          if (root.__closeButton) {\n            root.__closeButton.style.width = root.width + 'px';\n          }\n\n        },\n\n        /**\n         * Mark objects for saving. The order of these objects cannot change as\n         * the GUI grows. When remembering new objects, append them to the end\n         * of the list.\n         *\n         * @param {Object...} objects\n         * @throws {Error} if not called on a top level GUI.\n         * @instance\n         */\n        remember: function() {\n\n          if (common.isUndefined(SAVE_DIALOGUE)) {\n            SAVE_DIALOGUE = new CenteredDiv();\n            SAVE_DIALOGUE.domElement.innerHTML = saveDialogueContents;\n          }\n\n          if (this.parent) {\n            throw new Error(\"You can only call remember on a top level GUI.\");\n          }\n\n          var _this = this;\n\n          common.each(Array.prototype.slice.call(arguments), function(object) {\n            if (_this.__rememberedObjects.length == 0) {\n              addSaveMenu(_this);\n            }\n            if (_this.__rememberedObjects.indexOf(object) == -1) {\n              _this.__rememberedObjects.push(object);\n            }\n          });\n\n          if (this.autoPlace) {\n            // Set save row width\n            setWidth(this, this.width);\n          }\n\n        },\n\n        /**\n         * @returns {dat.gui.GUI} the topmost parent GUI of a nested GUI.\n         * @instance\n         */\n        getRoot: function() {\n          var gui = this;\n          while (gui.parent) {\n            gui = gui.parent;\n          }\n          return gui;\n        },\n\n        /**\n         * @returns {Object} a JSON object representing the current state of\n         * this GUI as well as its remembered properties.\n         * @instance\n         */\n        getSaveObject: function() {\n\n          var toReturn = this.load;\n\n          toReturn.closed = this.closed;\n\n          // Am I remembering any values?\n          if (this.__rememberedObjects.length > 0) {\n\n            toReturn.preset = this.preset;\n\n            if (!toReturn.remembered) {\n              toReturn.remembered = {};\n            }\n\n            toReturn.remembered[this.preset] = getCurrentPreset(this);\n\n          }\n\n          toReturn.folders = {};\n          common.each(this.__folders, function(element, key) {\n            toReturn.folders[key] = element.getSaveObject();\n          });\n\n          return toReturn;\n\n        },\n\n        save: function() {\n\n          if (!this.load.remembered) {\n            this.load.remembered = {};\n          }\n\n          this.load.remembered[this.preset] = getCurrentPreset(this);\n          markPresetModified(this, false);\n\n        },\n\n        saveAs: function(presetName) {\n\n          if (!this.load.remembered) {\n\n            // Retain default values upon first save\n            this.load.remembered = {};\n            this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n\n          }\n\n          this.load.remembered[presetName] = getCurrentPreset(this);\n          this.preset = presetName;\n          addPresetOption(this, presetName, true);\n\n        },\n\n        revert: function(gui) {\n\n          common.each(this.__controllers, function(controller) {\n            // Make revert work on Default.\n            if (!this.getRoot().load.remembered) {\n              controller.setValue(controller.initialValue);\n            } else {\n              recallSavedValue(gui || this.getRoot(), controller);\n            }\n          }, this);\n\n          common.each(this.__folders, function(folder) {\n            folder.revert(folder);\n          });\n\n          if (!gui) {\n            markPresetModified(this.getRoot(), false);\n          }\n\n\n        },\n\n        listen: function(controller) {\n\n          var init = this.__listening.length == 0;\n          this.__listening.push(controller);\n          if (init) updateDisplays(this.__listening);\n\n        }\n\n      }\n\n  );\n\n  function add(gui, object, property, params) {\n\n    if (object[property] === undefined) {\n      throw new Error(\"Object \" + object + \" has no property \\\"\" + property + \"\\\"\");\n    }\n\n    var controller;\n\n    if (params.color) {\n\n      controller = new ColorController(object, property);\n\n    } else {\n\n      var factoryArgs = [object,property].concat(params.factoryArgs);\n      controller = controllerFactory.apply(gui, factoryArgs);\n\n    }\n\n    if (params.before instanceof Controller) {\n      params.before = params.before.__li;\n    }\n\n    recallSavedValue(gui, controller);\n\n    dom.addClass(controller.domElement, 'c');\n\n    var name = document.createElement('span');\n    dom.addClass(name, 'property-name');\n    name.innerHTML = controller.property;\n\n    var container = document.createElement('div');\n    container.appendChild(name);\n    container.appendChild(controller.domElement);\n\n    var li = addRow(gui, container, params.before);\n\n    dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n    dom.addClass(li, typeof controller.getValue());\n\n    augmentController(gui, li, controller);\n\n    gui.__controllers.push(controller);\n\n    return controller;\n\n  }\n\n  /**\n   * Add a row to the end of the GUI or before another row.\n   *\n   * @param gui\n   * @param [dom] If specified, inserts the dom content in the new row\n   * @param [liBefore] If specified, places the new row before another row\n   */\n  function addRow(gui, dom, liBefore) {\n    var li = document.createElement('li');\n    if (dom) li.appendChild(dom);\n    if (liBefore) {\n      gui.__ul.insertBefore(li, params.before);\n    } else {\n      gui.__ul.appendChild(li);\n    }\n    gui.onResize();\n    return li;\n  }\n\n  function augmentController(gui, li, controller) {\n\n    controller.__li = li;\n    controller.__gui = gui;\n\n    common.extend(controller, {\n\n      options: function(options) {\n\n        if (arguments.length > 1) {\n          controller.remove();\n\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [common.toArray(arguments)]\n              }\n          );\n\n        }\n\n        if (common.isArray(options) || common.isObject(options)) {\n          controller.remove();\n\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [options]\n              }\n          );\n\n        }\n\n      },\n\n      name: function(v) {\n        controller.__li.firstElementChild.firstElementChild.innerHTML = v;\n        return controller;\n      },\n\n      listen: function() {\n        controller.__gui.listen(controller);\n        return controller;\n      },\n\n      remove: function() {\n        controller.__gui.remove(controller);\n        return controller;\n      }\n\n    });\n\n    // All sliders should be accompanied by a box.\n    if (controller instanceof NumberControllerSlider) {\n\n      var box = new NumberControllerBox(controller.object, controller.property,\n          { min: controller.__min, max: controller.__max, step: controller.__step });\n\n      common.each(['updateDisplay', 'onChange', 'onFinishChange'], function(method) {\n        var pc = controller[method];\n        var pb = box[method];\n        controller[method] = box[method] = function() {\n          var args = Array.prototype.slice.call(arguments);\n          pc.apply(controller, args);\n          return pb.apply(box, args);\n        }\n      });\n\n      dom.addClass(li, 'has-slider');\n      controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n\n    }\n    else if (controller instanceof NumberControllerBox) {\n\n      var r = function(returned) {\n\n        // Have we defined both boundaries?\n        if (common.isNumber(controller.__min) && common.isNumber(controller.__max)) {\n\n          // Well, then lets just replace this with a slider.\n          controller.remove();\n          return add(\n              gui,\n              controller.object,\n              controller.property,\n              {\n                before: controller.__li.nextElementSibling,\n                factoryArgs: [controller.__min, controller.__max, controller.__step]\n              });\n\n        }\n\n        return returned;\n\n      };\n\n      controller.min = common.compose(r, controller.min);\n      controller.max = common.compose(r, controller.max);\n\n    }\n    else if (controller instanceof BooleanController) {\n\n      dom.bind(li, 'click', function() {\n        dom.fakeEvent(controller.__checkbox, 'click');\n      });\n\n      dom.bind(controller.__checkbox, 'click', function(e) {\n        e.stopPropagation(); // Prevents double-toggle\n      })\n\n    }\n    else if (controller instanceof FunctionController) {\n\n      dom.bind(li, 'click', function() {\n        dom.fakeEvent(controller.__button, 'click');\n      });\n\n      dom.bind(li, 'mouseover', function() {\n        dom.addClass(controller.__button, 'hover');\n      });\n\n      dom.bind(li, 'mouseout', function() {\n        dom.removeClass(controller.__button, 'hover');\n      });\n\n    }\n    else if (controller instanceof ColorController) {\n\n      dom.addClass(li, 'color');\n      controller.updateDisplay = common.compose(function(r) {\n        li.style.borderLeftColor = controller.__color.toString();\n        return r;\n      }, controller.updateDisplay);\n\n      controller.updateDisplay();\n\n    }\n\n    controller.setValue = common.compose(function(r) {\n      if (gui.getRoot().__preset_select && controller.isModified()) {\n        markPresetModified(gui.getRoot(), true);\n      }\n      return r;\n    }, controller.setValue);\n\n  }\n\n  function recallSavedValue(gui, controller) {\n\n    // Find the topmost GUI, that's where remembered objects live.\n    var root = gui.getRoot();\n\n    // Does the object we're controlling match anything we've been told to\n    // remember?\n    var matched_index = root.__rememberedObjects.indexOf(controller.object);\n\n    // Why yes, it does!\n    if (matched_index != -1) {\n\n      // Let me fetch a map of controllers for thcommon.isObject.\n      var controller_map =\n          root.__rememberedObjectIndecesToControllers[matched_index];\n\n      // Ohp, I believe this is the first controller we've created for this\n      // object. Lets make the map fresh.\n      if (controller_map === undefined) {\n        controller_map = {};\n        root.__rememberedObjectIndecesToControllers[matched_index] =\n            controller_map;\n      }\n\n      // Keep track of this controller\n      controller_map[controller.property] = controller;\n\n      // Okay, now have we saved any values for this controller?\n      if (root.load && root.load.remembered) {\n\n        var preset_map = root.load.remembered;\n\n        // Which preset are we trying to load?\n        var preset;\n\n        if (preset_map[gui.preset]) {\n\n          preset = preset_map[gui.preset];\n\n        } else if (preset_map[DEFAULT_DEFAULT_PRESET_NAME]) {\n\n          // Uhh, you can have the default instead?\n          preset = preset_map[DEFAULT_DEFAULT_PRESET_NAME];\n\n        } else {\n\n          // Nada.\n\n          return;\n\n        }\n\n\n        // Did the loaded object remember thcommon.isObject?\n        if (preset[matched_index] &&\n\n          // Did we remember this particular property?\n            preset[matched_index][controller.property] !== undefined) {\n\n          // We did remember something for this guy ...\n          var value = preset[matched_index][controller.property];\n\n          // And that's what it is.\n          controller.initialValue = value;\n          controller.setValue(value);\n\n        }\n\n      }\n\n    }\n\n  }\n\n  function getLocalStorageHash(gui, key) {\n    // TODO how does this deal with multiple GUI's?\n    return document.location.href + '.' + key;\n\n  }\n\n  function addSaveMenu(gui) {\n\n    var div = gui.__save_row = document.createElement('li');\n\n    dom.addClass(gui.domElement, 'has-save');\n\n    gui.__ul.insertBefore(div, gui.__ul.firstChild);\n\n    dom.addClass(div, 'save-row');\n\n    var gears = document.createElement('span');\n    gears.innerHTML = '&nbsp;';\n    dom.addClass(gears, 'button gears');\n\n    // TODO replace with FunctionController\n    var button = document.createElement('span');\n    button.innerHTML = 'Save';\n    dom.addClass(button, 'button');\n    dom.addClass(button, 'save');\n\n    var button2 = document.createElement('span');\n    button2.innerHTML = 'New';\n    dom.addClass(button2, 'button');\n    dom.addClass(button2, 'save-as');\n\n    var button3 = document.createElement('span');\n    button3.innerHTML = 'Revert';\n    dom.addClass(button3, 'button');\n    dom.addClass(button3, 'revert');\n\n    var select = gui.__preset_select = document.createElement('select');\n\n    if (gui.load && gui.load.remembered) {\n\n      common.each(gui.load.remembered, function(value, key) {\n        addPresetOption(gui, key, key == gui.preset);\n      });\n\n    } else {\n      addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n    }\n\n    dom.bind(select, 'change', function() {\n\n\n      for (var index = 0; index < gui.__preset_select.length; index++) {\n        gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n      }\n\n      gui.preset = this.value;\n\n    });\n\n    div.appendChild(select);\n    div.appendChild(gears);\n    div.appendChild(button);\n    div.appendChild(button2);\n    div.appendChild(button3);\n\n    if (SUPPORTS_LOCAL_STORAGE) {\n\n      var saveLocally = document.getElementById('dg-save-locally');\n      var explain = document.getElementById('dg-local-explain');\n\n      saveLocally.style.display = 'block';\n\n      var localStorageCheckBox = document.getElementById('dg-local-storage');\n\n      if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n        localStorageCheckBox.setAttribute('checked', 'checked');\n      }\n\n      function showHideExplain() {\n        explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n      }\n\n      showHideExplain();\n\n      // TODO: Use a boolean controller, fool!\n      dom.bind(localStorageCheckBox, 'change', function() {\n        gui.useLocalStorage = !gui.useLocalStorage;\n        showHideExplain();\n      });\n\n    }\n\n    var newConstructorTextArea = document.getElementById('dg-new-constructor');\n\n    dom.bind(newConstructorTextArea, 'keydown', function(e) {\n      if (e.metaKey && (e.which === 67 || e.keyCode == 67)) {\n        SAVE_DIALOGUE.hide();\n      }\n    });\n\n    dom.bind(gears, 'click', function() {\n      newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n      SAVE_DIALOGUE.show();\n      newConstructorTextArea.focus();\n      newConstructorTextArea.select();\n    });\n\n    dom.bind(button, 'click', function() {\n      gui.save();\n    });\n\n    dom.bind(button2, 'click', function() {\n      var presetName = prompt('Enter a new preset name.');\n      if (presetName) gui.saveAs(presetName);\n    });\n\n    dom.bind(button3, 'click', function() {\n      gui.revert();\n    });\n\n//    div.appendChild(button2);\n\n  }\n\n  function addResizeHandle(gui) {\n\n    gui.__resize_handle = document.createElement('div');\n\n    common.extend(gui.__resize_handle.style, {\n\n      width: '6px',\n      marginLeft: '-3px',\n      height: '200px',\n      cursor: 'ew-resize',\n      position: 'absolute'\n//      border: '1px solid blue'\n\n    });\n\n    var pmouseX;\n\n    dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n    dom.bind(gui.__closeButton, 'mousedown', dragStart);\n\n    gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n\n    function dragStart(e) {\n\n      e.preventDefault();\n\n      pmouseX = e.clientX;\n\n      dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n      dom.bind(window, 'mousemove', drag);\n      dom.bind(window, 'mouseup', dragStop);\n\n      return false;\n\n    }\n\n    function drag(e) {\n\n      e.preventDefault();\n\n      gui.width += pmouseX - e.clientX;\n      gui.onResize();\n      pmouseX = e.clientX;\n\n      return false;\n\n    }\n\n    function dragStop() {\n\n      dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n      dom.unbind(window, 'mousemove', drag);\n      dom.unbind(window, 'mouseup', dragStop);\n\n    }\n\n  }\n\n  function setWidth(gui, w) {\n    gui.domElement.style.width = w + 'px';\n    // Auto placed save-rows are position fixed, so we have to\n    // set the width manually if we want it to bleed to the edge\n    if (gui.__save_row && gui.autoPlace) {\n      gui.__save_row.style.width = w + 'px';\n    }if (gui.__closeButton) {\n      gui.__closeButton.style.width = w + 'px';\n    }\n  }\n\n  function getCurrentPreset(gui, useInitialValues) {\n\n    var toReturn = {};\n\n    // For each object I'm remembering\n    common.each(gui.__rememberedObjects, function(val, index) {\n\n      var saved_values = {};\n\n      // The controllers I've made for thcommon.isObject by property\n      var controller_map =\n          gui.__rememberedObjectIndecesToControllers[index];\n\n      // Remember each value for each property\n      common.each(controller_map, function(controller, property) {\n        saved_values[property] = useInitialValues ? controller.initialValue : controller.getValue();\n      });\n\n      // Save the values for thcommon.isObject\n      toReturn[index] = saved_values;\n\n    });\n\n    return toReturn;\n\n  }\n\n  function addPresetOption(gui, name, setSelected) {\n    var opt = document.createElement('option');\n    opt.innerHTML = name;\n    opt.value = name;\n    gui.__preset_select.appendChild(opt);\n    if (setSelected) {\n      gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n    }\n  }\n\n  function setPresetSelectIndex(gui) {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      if (gui.__preset_select[index].value == gui.preset) {\n        gui.__preset_select.selectedIndex = index;\n      }\n    }\n  }\n\n  function markPresetModified(gui, modified) {\n    var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n//    console.log('mark', modified, opt);\n    if (modified) {\n      opt.innerHTML = opt.value + \"*\";\n    } else {\n      opt.innerHTML = opt.value;\n    }\n  }\n\n  function updateDisplays(controllerArray) {\n\n\n    if (controllerArray.length != 0) {\n\n      requestAnimationFrame(function() {\n        updateDisplays(controllerArray);\n      });\n\n    }\n\n    common.each(controllerArray, function(c) {\n      c.updateDisplay();\n    });\n\n  }\n\n  return GUI;\n\n})(dat.utils.css,\n\"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n      \\n    </div>\\n    \\n  </div>\\n\\n</div>\",\n\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\",\ndat.controllers.factory = (function (OptionController, NumberControllerBox, NumberControllerSlider, StringController, FunctionController, BooleanController, common) {\n\n      return function(object, property) {\n\n        var initialValue = object[property];\n\n        // Providing options?\n        if (common.isArray(arguments[2]) || common.isObject(arguments[2])) {\n          return new OptionController(object, property, arguments[2]);\n        }\n\n        // Providing a map?\n\n        if (common.isNumber(initialValue)) {\n\n          if (common.isNumber(arguments[2]) && common.isNumber(arguments[3])) {\n\n            // Has min and max.\n            return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n\n          } else {\n\n            return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n\n          }\n\n        }\n\n        if (common.isString(initialValue)) {\n          return new StringController(object, property);\n        }\n\n        if (common.isFunction(initialValue)) {\n          return new FunctionController(object, property, '');\n        }\n\n        if (common.isBoolean(initialValue)) {\n          return new BooleanController(object, property);\n        }\n\n      }\n\n    })(dat.controllers.OptionController,\ndat.controllers.NumberControllerBox,\ndat.controllers.NumberControllerSlider,\ndat.controllers.StringController = (function (Controller, dom, common) {\n\n  /**\n   * @class Provides a text input to alter the string property of an object.\n   *\n   * @extends dat.controllers.Controller\n   *\n   * @param {Object} object The object to be manipulated\n   * @param {string} property The name of the property to be manipulated\n   *\n   * @member dat.controllers\n   */\n  var StringController = function(object, property) {\n\n    StringController.superclass.call(this, object, property);\n\n    var _this = this;\n\n    this.__input = document.createElement('input');\n    this.__input.setAttribute('type', 'text');\n\n    dom.bind(this.__input, 'keyup', onChange);\n    dom.bind(this.__input, 'change', onChange);\n    dom.bind(this.__input, 'blur', onBlur);\n    dom.bind(this.__input, 'keydown', function(e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    \n\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n\n    this.updateDisplay();\n\n    this.domElement.appendChild(this.__input);\n\n  };\n\n  StringController.superclass = Controller;\n\n  common.extend(\n\n      StringController.prototype,\n      Controller.prototype,\n\n      {\n\n        updateDisplay: function() {\n          // Stops the caret from moving on account of:\n          // keyup -> setValue -> updateDisplay\n          if (!dom.isActive(this.__input)) {\n            this.__input.value = this.getValue();\n          }\n          return StringController.superclass.prototype.updateDisplay.call(this);\n        }\n\n      }\n\n  );\n\n  return StringController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.utils.common),\ndat.controllers.FunctionController,\ndat.controllers.BooleanController,\ndat.utils.common),\ndat.controllers.Controller,\ndat.controllers.BooleanController,\ndat.controllers.FunctionController,\ndat.controllers.NumberControllerBox,\ndat.controllers.NumberControllerSlider,\ndat.controllers.OptionController,\ndat.controllers.ColorController = (function (Controller, dom, Color, interpret, common) {\n\n  var ColorController = function(object, property) {\n\n    ColorController.superclass.call(this, object, property);\n\n    this.__color = new Color(this.getValue());\n    this.__temp = new Color(0);\n\n    var _this = this;\n\n    this.domElement = document.createElement('div');\n\n    dom.makeSelectable(this.domElement, false);\n\n    this.__selector = document.createElement('div');\n    this.__selector.className = 'selector';\n\n    this.__saturation_field = document.createElement('div');\n    this.__saturation_field.className = 'saturation-field';\n\n    this.__field_knob = document.createElement('div');\n    this.__field_knob.className = 'field-knob';\n    this.__field_knob_border = '2px solid ';\n\n    this.__hue_knob = document.createElement('div');\n    this.__hue_knob.className = 'hue-knob';\n\n    this.__hue_field = document.createElement('div');\n    this.__hue_field.className = 'hue-field';\n\n    this.__input = document.createElement('input');\n    this.__input.type = 'text';\n    this.__input_textShadow = '0 1px 1px ';\n\n    dom.bind(this.__input, 'keydown', function(e) {\n      if (e.keyCode === 13) { // on enter\n        onBlur.call(this);\n      }\n    });\n\n    dom.bind(this.__input, 'blur', onBlur);\n\n    dom.bind(this.__selector, 'mousedown', function(e) {\n\n      dom\n        .addClass(this, 'drag')\n        .bind(window, 'mouseup', function(e) {\n          dom.removeClass(_this.__selector, 'drag');\n        });\n\n    });\n\n    var value_field = document.createElement('div');\n\n    common.extend(this.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n\n    common.extend(this.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: this.__field_knob_border + (this.__color.v < .5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    \n    common.extend(this.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n\n    common.extend(this.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n\n    common.extend(value_field.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    \n    linearGradient(value_field, 'top', 'rgba(0,0,0,0)', '#000');\n\n    common.extend(this.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      display: 'inline-block',\n      border: '1px solid #555',\n      cursor: 'ns-resize'\n    });\n\n    hueGradient(this.__hue_field);\n\n    common.extend(this.__input.style, {\n      outline: 'none',\n//      width: '120px',\n      textAlign: 'center',\n//      padding: '4px',\n//      marginBottom: '6px',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: this.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n\n    dom.bind(this.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(this.__field_knob, 'mousedown', fieldDown);\n\n    dom.bind(this.__hue_field, 'mousedown', function(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'mouseup', unbindH);\n    });\n\n    function fieldDown(e) {\n      setSV(e);\n      // document.body.style.cursor = 'none';\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'mouseup', unbindSV);\n    }\n\n    function unbindSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'mouseup', unbindSV);\n      // document.body.style.cursor = 'default';\n    }\n\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n\n    function unbindH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'mouseup', unbindH);\n    }\n\n    this.__saturation_field.appendChild(value_field);\n    this.__selector.appendChild(this.__field_knob);\n    this.__selector.appendChild(this.__saturation_field);\n    this.__selector.appendChild(this.__hue_field);\n    this.__hue_field.appendChild(this.__hue_knob);\n\n    this.domElement.appendChild(this.__input);\n    this.domElement.appendChild(this.__selector);\n\n    this.updateDisplay();\n\n    function setSV(e) {\n\n      e.preventDefault();\n\n      var w = dom.getWidth(_this.__saturation_field);\n      var o = dom.getOffset(_this.__saturation_field);\n      var s = (e.clientX - o.left + document.body.scrollLeft) / w;\n      var v = 1 - (e.clientY - o.top + document.body.scrollTop) / w;\n\n      if (v > 1) v = 1;\n      else if (v < 0) v = 0;\n\n      if (s > 1) s = 1;\n      else if (s < 0) s = 0;\n\n      _this.__color.v = v;\n      _this.__color.s = s;\n\n      _this.setValue(_this.__color.toOriginal());\n\n\n      return false;\n\n    }\n\n    function setH(e) {\n\n      e.preventDefault();\n\n      var s = dom.getHeight(_this.__hue_field);\n      var o = dom.getOffset(_this.__hue_field);\n      var h = 1 - (e.clientY - o.top + document.body.scrollTop) / s;\n\n      if (h > 1) h = 1;\n      else if (h < 0) h = 0;\n\n      _this.__color.h = h * 360;\n\n      _this.setValue(_this.__color.toOriginal());\n\n      return false;\n\n    }\n\n  };\n\n  ColorController.superclass = Controller;\n\n  common.extend(\n\n      ColorController.prototype,\n      Controller.prototype,\n\n      {\n\n        updateDisplay: function() {\n\n          var i = interpret(this.getValue());\n\n          if (i !== false) {\n\n            var mismatch = false;\n\n            // Check for mismatch on the interpreted value.\n\n            common.each(Color.COMPONENTS, function(component) {\n              if (!common.isUndefined(i[component]) &&\n                  !common.isUndefined(this.__color.__state[component]) &&\n                  i[component] !== this.__color.__state[component]) {\n                mismatch = true;\n                return {}; // break\n              }\n            }, this);\n\n            // If nothing diverges, we keep our previous values\n            // for statefulness, otherwise we recalculate fresh\n            if (mismatch) {\n              common.extend(this.__color.__state, i);\n            }\n\n          }\n\n          common.extend(this.__temp.__state, this.__color.__state);\n\n          this.__temp.a = 1;\n\n          var flip = (this.__color.v < .5 || this.__color.s > .5) ? 255 : 0;\n          var _flip = 255 - flip;\n\n          common.extend(this.__field_knob.style, {\n            marginLeft: 100 * this.__color.s - 7 + 'px',\n            marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n            backgroundColor: this.__temp.toString(),\n            border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip +')'\n          });\n\n          this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px'\n\n          this.__temp.s = 1;\n          this.__temp.v = 1;\n\n          linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toString());\n\n          common.extend(this.__input.style, {\n            backgroundColor: this.__input.value = this.__color.toString(),\n            color: 'rgb(' + flip + ',' + flip + ',' + flip +')',\n            textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip +',.7)'\n          });\n\n        }\n\n      }\n\n  );\n  \n  var vendors = ['-moz-','-o-','-webkit-','-ms-',''];\n  \n  function linearGradient(elem, x, a, b) {\n    elem.style.background = '';\n    common.each(vendors, function(vendor) {\n      elem.style.cssText += 'background: ' + vendor + 'linear-gradient('+x+', '+a+' 0%, ' + b + ' 100%); ';\n    });\n  }\n  \n  function hueGradient(elem) {\n    elem.style.background = '';\n    elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);'\n    elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n    elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);'\n  }\n\n\n  return ColorController;\n\n})(dat.controllers.Controller,\ndat.dom.dom,\ndat.color.Color = (function (interpret, math, toString, common) {\n\n  var Color = function() {\n\n    this.__state = interpret.apply(this, arguments);\n\n    if (this.__state === false) {\n      throw 'Failed to interpret color arguments';\n    }\n\n    this.__state.a = this.__state.a || 1;\n\n\n  };\n\n  Color.COMPONENTS = ['r','g','b','h','s','v','hex','a'];\n\n  common.extend(Color.prototype, {\n\n    toString: function() {\n      return toString(this);\n    },\n\n    toOriginal: function() {\n      return this.__state.conversion.write(this);\n    }\n\n  });\n\n  defineRGBComponent(Color.prototype, 'r', 2);\n  defineRGBComponent(Color.prototype, 'g', 1);\n  defineRGBComponent(Color.prototype, 'b', 0);\n\n  defineHSVComponent(Color.prototype, 'h');\n  defineHSVComponent(Color.prototype, 's');\n  defineHSVComponent(Color.prototype, 'v');\n\n  Object.defineProperty(Color.prototype, 'a', {\n\n    get: function() {\n      return this.__state.a;\n    },\n\n    set: function(v) {\n      this.__state.a = v;\n    }\n\n  });\n\n  Object.defineProperty(Color.prototype, 'hex', {\n\n    get: function() {\n\n      if (!this.__state.space !== 'HEX') {\n        this.__state.hex = math.rgb_to_hex(this.r, this.g, this.b);\n      }\n\n      return this.__state.hex;\n\n    },\n\n    set: function(v) {\n\n      this.__state.space = 'HEX';\n      this.__state.hex = v;\n\n    }\n\n  });\n\n  function defineRGBComponent(target, component, componentHexIndex) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'RGB') {\n          return this.__state[component];\n        }\n\n        recalculateRGB(this, component, componentHexIndex);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'RGB') {\n          recalculateRGB(this, component, componentHexIndex);\n          this.__state.space = 'RGB';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function defineHSVComponent(target, component) {\n\n    Object.defineProperty(target, component, {\n\n      get: function() {\n\n        if (this.__state.space === 'HSV')\n          return this.__state[component];\n\n        recalculateHSV(this);\n\n        return this.__state[component];\n\n      },\n\n      set: function(v) {\n\n        if (this.__state.space !== 'HSV') {\n          recalculateHSV(this);\n          this.__state.space = 'HSV';\n        }\n\n        this.__state[component] = v;\n\n      }\n\n    });\n\n  }\n\n  function recalculateRGB(color, component, componentHexIndex) {\n\n    if (color.__state.space === 'HEX') {\n\n      color.__state[component] = math.component_from_hex(color.__state.hex, componentHexIndex);\n\n    } else if (color.__state.space === 'HSV') {\n\n      common.extend(color.__state, math.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n\n    } else {\n\n      throw 'Corrupted color state';\n\n    }\n\n  }\n\n  function recalculateHSV(color) {\n\n    var result = math.rgb_to_hsv(color.r, color.g, color.b);\n\n    common.extend(color.__state,\n        {\n          s: result.s,\n          v: result.v\n        }\n    );\n\n    if (!common.isNaN(result.h)) {\n      color.__state.h = result.h;\n    } else if (common.isUndefined(color.__state.h)) {\n      color.__state.h = 0;\n    }\n\n  }\n\n  return Color;\n\n})(dat.color.interpret,\ndat.color.math = (function () {\n\n  var tmpComponent;\n\n  return {\n\n    hsv_to_rgb: function(h, s, v) {\n\n      var hi = Math.floor(h / 60) % 6;\n\n      var f = h / 60 - Math.floor(h / 60);\n      var p = v * (1.0 - s);\n      var q = v * (1.0 - (f * s));\n      var t = v * (1.0 - ((1.0 - f) * s));\n      var c = [\n        [v, t, p],\n        [q, v, p],\n        [p, v, t],\n        [p, q, v],\n        [t, p, v],\n        [v, p, q]\n      ][hi];\n\n      return {\n        r: c[0] * 255,\n        g: c[1] * 255,\n        b: c[2] * 255\n      };\n\n    },\n\n    rgb_to_hsv: function(r, g, b) {\n\n      var min = Math.min(r, g, b),\n          max = Math.max(r, g, b),\n          delta = max - min,\n          h, s;\n\n      if (max != 0) {\n        s = delta / max;\n      } else {\n        return {\n          h: NaN,\n          s: 0,\n          v: 0\n        };\n      }\n\n      if (r == max) {\n        h = (g - b) / delta;\n      } else if (g == max) {\n        h = 2 + (b - r) / delta;\n      } else {\n        h = 4 + (r - g) / delta;\n      }\n      h /= 6;\n      if (h < 0) {\n        h += 1;\n      }\n\n      return {\n        h: h * 360,\n        s: s,\n        v: max / 255\n      };\n    },\n\n    rgb_to_hex: function(r, g, b) {\n      var hex = this.hex_with_component(0, 2, r);\n      hex = this.hex_with_component(hex, 1, g);\n      hex = this.hex_with_component(hex, 0, b);\n      return hex;\n    },\n\n    component_from_hex: function(hex, componentIndex) {\n      return (hex >> (componentIndex * 8)) & 0xFF;\n    },\n\n    hex_with_component: function(hex, componentIndex, value) {\n      return value << (tmpComponent = componentIndex * 8) | (hex & ~ (0xFF << tmpComponent));\n    }\n\n  }\n\n})(),\ndat.color.toString,\ndat.utils.common),\ndat.color.interpret,\ndat.utils.common),\ndat.utils.requestAnimationFrame = (function () {\n\n  /**\n   * requirejs version of Paul Irish's RequestAnimationFrame\n   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   */\n\n  return window.webkitRequestAnimationFrame ||\n      window.mozRequestAnimationFrame ||\n      window.oRequestAnimationFrame ||\n      window.msRequestAnimationFrame ||\n      function(callback, element) {\n\n        window.setTimeout(callback, 1000 / 60);\n\n      };\n})(),\ndat.dom.CenteredDiv = (function (dom, common) {\n\n\n  var CenteredDiv = function() {\n\n    this.backgroundElement = document.createElement('div');\n    common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear'\n    });\n\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n\n    this.domElement = document.createElement('div');\n    common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear'\n    });\n\n\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function() {\n      _this.hide();\n    });\n\n\n  };\n\n  CenteredDiv.prototype.show = function() {\n\n    var _this = this;\n    \n\n\n    this.backgroundElement.style.display = 'block';\n\n    this.domElement.style.display = 'block';\n    this.domElement.style.opacity = 0;\n//    this.domElement.style.top = '52%';\n    this.domElement.style.webkitTransform = 'scale(1.1)';\n\n    this.layout();\n\n    common.defer(function() {\n      _this.backgroundElement.style.opacity = 1;\n      _this.domElement.style.opacity = 1;\n      _this.domElement.style.webkitTransform = 'scale(1)';\n    });\n\n  };\n\n  CenteredDiv.prototype.hide = function() {\n\n    var _this = this;\n\n    var hide = function() {\n\n      _this.domElement.style.display = 'none';\n      _this.backgroundElement.style.display = 'none';\n\n      dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n      dom.unbind(_this.domElement, 'transitionend', hide);\n      dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n\n    };\n\n    dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n    dom.bind(this.domElement, 'transitionend', hide);\n    dom.bind(this.domElement, 'oTransitionEnd', hide);\n\n    this.backgroundElement.style.opacity = 0;\n//    this.domElement.style.top = '48%';\n    this.domElement.style.opacity = 0;\n    this.domElement.style.webkitTransform = 'scale(1.1)';\n\n  };\n\n  CenteredDiv.prototype.layout = function() {\n    this.domElement.style.left = window.innerWidth/2 - dom.getWidth(this.domElement) / 2 + 'px';\n    this.domElement.style.top = window.innerHeight/2 - dom.getHeight(this.domElement) / 2 + 'px';\n  };\n  \n  function lockScroll(e) {\n    console.log(e);\n  }\n\n  return CenteredDiv;\n\n})(dat.dom.dom,\ndat.utils.common),\ndat.dom.dom,\ndat.utils.common);"]}